// Generated by CoffeeScript 1.6.3
var Environment, TipBasedVPL, TipTable,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Environment = (function() {
  function Environment() {}

  Environment.ScreenWidth = 640;

  Environment.ScreenHeight = 640;

  Environment.EditorWidth = 480;

  Environment.EditorHeight = 480;

  Environment.EditorX = 16;

  Environment.EditorY = 16;

  Environment.startX = 4;

  Environment.startY = -1;

  return Environment;

})();

TipTable = (function() {
  function TipTable() {}

  TipTable.tips = [];

  TipTable.clear = function() {
    return this.tips = [];
  };

  TipTable.addTip = function(tip) {
    return this.tips.push(tip);
  };

  TipTable.addInstruction = function(inst) {
    var tip;
    tip = TipFactory.createInstructionTip(inst);
    return TipTable.addTip(tip);
  };

  TipTable.findByInst = function(instName) {
    var tip;
    return ((function() {
      var _i, _len, _ref, _results;
      _ref = this.tips;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        tip = _ref[_i];
        if ((tip.code.instruction != null) && tip.code.instruction.constructor.name === instName) {
          _results.push(tip);
        }
      }
      return _results;
    }).call(this))[0];
  };

  TipTable.findByCode = function(codeName) {
    var tip;
    return ((function() {
      var _i, _len, _ref, _results;
      _ref = this.tips;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        tip = _ref[_i];
        if (tip.code.constructor.name === codeName) {
          _results.push(tip);
        }
      }
      return _results;
    }).call(this))[0];
  };

  return TipTable;

})();

TipBasedVPL = (function(_super) {
  __extends(TipBasedVPL, _super);

  function TipBasedVPL(w, h, resourceBase) {
    TipBasedVPL.__super__.constructor.call(this, w, h);
    this.fps = 24;
    Resources.base = resourceBase;
    Resources.load(this);
  }

  TipBasedVPL.prototype.addInstruction = function(instruction) {
    return TipTable.addInstruction(instruction);
  };

  TipBasedVPL.prototype.addPresetInstructions = function() {
    var counters, i, inst, nopTip, returnTip, stack, stopTip, _i;
    stack = new StackMachine();
    counters = [];
    for (i = _i = 0; _i < 100; i = ++_i) {
      counters[i] = new Counter();
    }
    returnTip = TipFactory.createReturnTip(Environment.startX, Environment.startY);
    stopTip = TipFactory.createStopTip();
    nopTip = TipFactory.createNopTip();
    inst = new RandomBranchInstruction();
    TipTable.addInstruction(inst, Resources.get("iconRandom"));
    TipTable.addTip(returnTip);
    TipTable.addTip(stopTip);
    TipTable.addTip(nopTip, Resources.get("iconNop"));
    TipTable.addInstruction(new CounterIncrementInstruction(counters), Resources.get("iconRandom"));
    TipTable.addInstruction(new CounterDecrementInstruction(counters), Resources.get("iconRandom"));
    TipTable.addInstruction(new CounterBranchInstruction(counters), Resources.get("iconRandom"));
    TipTable.addInstruction(new CounterPushInstruction(counters, stack), Resources.get("iconRandom"));
    TipTable.addInstruction(new CounterPopInstruction(counters, stack), Resources.get("iconRandom"));
    TipTable.addInstruction(new StackAddInstruction(stack), Resources.get("iconRandom"));
    TipTable.addInstruction(new StackSubInstruction(stack), Resources.get("iconRandom"));
    TipTable.addInstruction(new StackMulInstruction(stack), Resources.get("iconRandom"));
    TipTable.addInstruction(new StackDivInstruction(stack), Resources.get("iconRandom"));
    TipTable.addInstruction(new StackModInstruction(stack), Resources.get("iconRandom"));
    TipTable.addInstruction(new StackXorInstruction(stack), Resources.get("iconRandom"));
    TipTable.addInstruction(new StackGrtInstruction(stack), Resources.get("iconRandom"));
    TipTable.addInstruction(new StackSwpInstruction(stack), Resources.get("iconRandom"));
    TipTable.addInstruction(new StackNotInstruction(stack), Resources.get("iconRandom"));
    TipTable.addInstruction(new StackDupInstruction(stack), Resources.get("iconRandom"));
    TipTable.addInstruction(new StackRotInstruction(stack), Resources.get("iconRandom"));
    return TipTable.addInstruction(new StackBnzInstruction(stack), Resources.get("iconRandom"));
  };

  TipBasedVPL.prototype.clearInstructions = function() {
    return TipTable.clear();
  };

  TipBasedVPL.prototype.loadInstruction = function() {
    var tip, _i, _len, _ref, _results;
    this.addPresetInstructions();
    _ref = TipTable.tips;
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      tip = _ref[_i];
      _results.push(Game.instance.vpl.ui.side.addTip(tip));
    }
    return _results;
  };

  TipBasedVPL.prototype.onload = function() {
    var back, selector, x, xnum, y, ynum;
    x = 16;
    y = 16;
    xnum = 8;
    ynum = 8;
    back = new TipBackground(x, y, xnum, ynum);
    Game.instance.vpl = {};
    Game.instance.vpl.ui = {};
    Game.instance.vpl.cpu = new Cpu(x + 12, y + 12, xnum, ynum, Environment.startX);
    Game.instance.vpl.executer = new Executer(Game.instance.vpl.cpu);
    Game.instance.vpl.ui.frame = new Frame(0, 0);
    Game.instance.vpl.ui.help = new HelpPanel(0, Environment.EditorHeight + y, Environment.ScreenWidth, Environment.ScreenWidth - Environment.EditorWidth - x, "");
    selector = new ParameterConfigPanel(Environment.EditorWidth + x / 2, 0);
    Game.instance.vpl.ui.side = new SideTipSelector(Environment.EditorWidth + x / 2, 0);
    Game.instance.vpl.ui.configPanel = new UIPanel(selector);
    Game.instance.vpl.ui.configPanel.setTitle(TextResource.msg.title["configurator"]);
    selector.parent = Game.instance.vpl.ui.configPanel;
    Game.instance.currentScene.addChild(back);
    Game.instance.currentScene.addChild(Game.instance.vpl.cpu);
    Game.instance.currentScene.addChild(Game.instance.vpl.ui.frame);
    Game.instance.currentScene.addChild(Game.instance.vpl.ui.side);
    return Game.instance.currentScene.addChild(Game.instance.vpl.ui.help);
  };

  return TipBasedVPL;

})(Game);
