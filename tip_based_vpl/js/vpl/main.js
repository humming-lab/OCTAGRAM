// Generated by CoffeeScript 1.6.3
var Environment, TipBasedVPL, TipSet, VirtualMachine,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Environment = (function() {
  function Environment() {}

  Environment.ScreenWidth = 640;

  Environment.ScreenHeight = 640;

  Environment.EditorWidth = 480;

  Environment.EditorHeight = 480;

  Environment.EditorX = 16;

  Environment.EditorY = 16;

  Environment.startX = 4;

  Environment.startY = -1;

  return Environment;

})();

TipSet = (function() {
  function TipSet() {
    this.tips = [];
  }

  TipSet.prototype.clear = function() {
    return this.tips = [];
  };

  TipSet.prototype.addTip = function(tip) {
    return this.tips.push(tip);
  };

  TipSet.prototype.addInstruction = function(inst) {
    var tip;
    tip = TipFactory.createInstructionTip(inst);
    return this.addTip(tip);
  };

  TipSet.prototype.findByInst = function(instName) {
    var tip;
    return ((function() {
      var _i, _len, _ref, _results;
      _ref = this.tips;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        tip = _ref[_i];
        if ((tip.code.instruction != null) && tip.code.instruction.constructor.name === instName) {
          _results.push(tip);
        }
      }
      return _results;
    }).call(this))[0];
  };

  TipSet.prototype.findByCode = function(codeName) {
    var tip;
    return ((function() {
      var _i, _len, _ref, _results;
      _ref = this.tips;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        tip = _ref[_i];
        if (tip.code.constructor.name === codeName) {
          _results.push(tip);
        }
      }
      return _results;
    }).call(this))[0];
  };

  return TipSet;

})();

VirtualMachine = (function() {
  function VirtualMachine(x, y, xnum, ynum) {
    this.tipSet = new TipSet();
    this.cpu = new Cpu(x + 12, y + 12, xnum, ynum, Environment.startX, this.tipSet);
    this.executer = new Executer(this.cpu);
  }

  VirtualMachine.prototype.addInstruction = function(instruction) {
    return this.cpu.tipSet.addInstruction(instruction);
  };

  VirtualMachine.prototype.addPresetInstructions = function() {
    var counters, i, inst, nopTip, returnTip, stack, stopTip, _i;
    stack = new StackMachine();
    counters = [];
    for (i = _i = 0; _i < 100; i = ++_i) {
      counters[i] = new Counter();
    }
    returnTip = TipFactory.createReturnTip(Environment.startX, Environment.startY);
    stopTip = TipFactory.createStopTip();
    nopTip = TipFactory.createNopTip();
    inst = new RandomBranchInstruction();
    this.cpu.tipSet.addInstruction(inst, Resources.get("iconRandom"));
    this.cpu.tipSet.addTip(returnTip);
    this.cpu.tipSet.addTip(stopTip);
    this.cpu.tipSet.addTip(nopTip, Resources.get("iconNop"));
    this.cpu.tipSet.addInstruction(new CounterIncrementInstruction(counters), Resources.get("iconRandom"));
    this.cpu.tipSet.addInstruction(new CounterDecrementInstruction(counters), Resources.get("iconRandom"));
    this.cpu.tipSet.addInstruction(new CounterBranchInstruction(counters), Resources.get("iconRandom"));
    this.cpu.tipSet.addInstruction(new CounterPushInstruction(counters, stack), Resources.get("iconRandom"));
    this.cpu.tipSet.addInstruction(new CounterPopInstruction(counters, stack), Resources.get("iconRandom"));
    this.cpu.tipSet.addInstruction(new StackAddInstruction(stack), Resources.get("iconRandom"));
    this.cpu.tipSet.addInstruction(new StackSubInstruction(stack), Resources.get("iconRandom"));
    this.cpu.tipSet.addInstruction(new StackMulInstruction(stack), Resources.get("iconRandom"));
    this.cpu.tipSet.addInstruction(new StackDivInstruction(stack), Resources.get("iconRandom"));
    this.cpu.tipSet.addInstruction(new StackModInstruction(stack), Resources.get("iconRandom"));
    this.cpu.tipSet.addInstruction(new StackXorInstruction(stack), Resources.get("iconRandom"));
    this.cpu.tipSet.addInstruction(new StackGrtInstruction(stack), Resources.get("iconRandom"));
    this.cpu.tipSet.addInstruction(new StackSwpInstruction(stack), Resources.get("iconRandom"));
    this.cpu.tipSet.addInstruction(new StackNotInstruction(stack), Resources.get("iconRandom"));
    this.cpu.tipSet.addInstruction(new StackDupInstruction(stack), Resources.get("iconRandom"));
    this.cpu.tipSet.addInstruction(new StackRotInstruction(stack), Resources.get("iconRandom"));
    return this.cpu.tipSet.addInstruction(new StackBnzInstruction(stack), Resources.get("iconRandom"));
  };

  VirtualMachine.prototype.clearInstructions = function() {
    return this.tipSet.clear();
  };

  VirtualMachine.prototype.show = function() {
    var tip, _i, _len, _ref;
    this.addPresetInstructions();
    _ref = this.cpu.tipSet.tips;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      tip = _ref[_i];
      Game.instance.vpl.ui.side.addTip(tip);
    }
    return Game.instance.currentScene.insertBefore(this.cpu, Game.instance.vpl.ui.frame);
  };

  return VirtualMachine;

})();

TipBasedVPL = (function(_super) {
  __extends(TipBasedVPL, _super);

  function TipBasedVPL(w, h, resourceBase) {
    TipBasedVPL.__super__.constructor.call(this, w, h);
    this.fps = 24;
    Resources.base = resourceBase;
    Resources.load(this);
  }

  TipBasedVPL.prototype.onload = function() {
    var back, selector, x, xnum, y, ynum;
    x = 16;
    y = 16;
    xnum = 8;
    ynum = 8;
    back = new TipBackground(x, y, xnum, ynum);
    Game.instance.vpl = {};
    Game.instance.vpl.ui = {};
    Game.instance.vpl.currentVM = new VirtualMachine(x, y, xnum, ynum);
    Game.instance.vpl.ui.frame = new Frame(0, 0);
    Game.instance.vpl.ui.help = new HelpPanel(0, Environment.EditorHeight + y, Environment.ScreenWidth, Environment.ScreenWidth - Environment.EditorWidth - x, "");
    selector = new ParameterConfigPanel(Environment.EditorWidth + x / 2, 0);
    Game.instance.vpl.ui.side = new SideTipSelector(Environment.EditorWidth + x / 2, 0);
    Game.instance.vpl.ui.configPanel = new UIPanel(selector);
    Game.instance.vpl.ui.configPanel.setTitle(TextResource.msg.title["configurator"]);
    selector.parent = Game.instance.vpl.ui.configPanel;
    Game.instance.currentScene.addChild(back);
    Game.instance.currentScene.addChild(Game.instance.vpl.ui.frame);
    Game.instance.currentScene.addChild(Game.instance.vpl.ui.side);
    return Game.instance.currentScene.addChild(Game.instance.vpl.ui.help);
  };

  return TipBasedVPL;

})(Game);
