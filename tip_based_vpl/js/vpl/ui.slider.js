// Generated by CoffeeScript 1.6.2
var Slider, SliderKnob,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

Slider = (function(_super) {
  __extends(Slider, _super);

  function Slider(min, max, step, value) {
    var labelPaddingX, labelPaddingY,
      _this = this;

    this.min = min;
    this.max = max;
    this.step = step;
    this.value = value;
    Slider.__super__.constructor.call(this, Resources.get("slider"));
    this.knob = new SliderKnob(this);
    this.label = new UITextComponent(this, "");
    labelPaddingY = 4;
    labelPaddingX = 12;
    this.titleWidth = 128;
    this.title = new UITextComponent(this, "");
    this.title.moveTo(-this.titleWidth, labelPaddingY);
    this.title.width = this.titleWidth;
    this.knob.moveTo(0, this.knob.width / 2);
    this.label.moveTo(this.getWidth() + labelPaddingX, labelPaddingY);
    this.knob.addEventListener('touchstart', function(e) {});
    this.knob.addEventListener('touchmove', function(e) {
      var x;

      x = e.x - _this.getAbsolutePosition().x;
      if (x < 0) {
        x = 0;
      }
      if (x > _this.getWidth()) {
        x = _this.getWidth();
      }
      value = _this.positionToValue(x);
      return _this.scroll(value);
    });
    this.knob.addEventListener('touchend', function(e) {});
    this.addEventListener('touchstart', function(e) {
      var x;

      x = e.x - this.getAbsolutePosition().x;
      value = this.positionToValue(x);
      return this.scroll(value);
    });
    this.scroll(this.value);
    LayerUtil.setOrder(this, LayerOrder.dialogUI);
    this.addChild(this.sprite);
    this.addChild(this.knob);
    this.addChild(this.label);
    this.addChild(this.title);
  }

  Slider.prototype.setTitle = function(title) {
    return this.title.text = title;
  };

  Slider.prototype.setValue = function(value) {
    this.value = value;
    return this.onValueChanged();
  };

  Slider.prototype.onValueChanged = function() {
    return this.setText(this.value);
  };

  Slider.prototype.setText = function(text) {
    return this.label.text = text;
  };

  Slider.prototype.scroll = function(value) {
    var x;

    this.value = this.adjustValue(value);
    x = this.valueToPosition(this.value);
    this.knob.moveTo(x - this.knob.width / 2, this.y + this.knob.height / 2);
    return this.onValueChanged();
  };

  Slider.prototype.adjustValue = function(value) {
    var dist, i, nearestDist, nearestValue, _i, _ref, _ref1, _ref2;

    nearestValue = this.min;
    nearestDist = 0xffffffff;
    for (i = _i = _ref = this.min, _ref1 = this.max, _ref2 = this.step; _ref2 > 0 ? _i <= _ref1 : _i >= _ref1; i = _i += _ref2) {
      dist = Math.abs(value - i);
      if (dist < nearestDist) {
        nearestDist = dist;
        nearestValue = i;
      }
    }
    return nearestValue;
  };

  Slider.prototype.valueToPosition = function(value) {
    var range, val, x;

    range = this.max - this.min;
    val = value - this.min;
    return x = this.getWidth() * (val / range);
  };

  Slider.prototype.positionToValue = function(x) {
    var normValue;

    normValue = x / this.getWidth();
    return this.min + normValue * (this.max - this.min);
  };

  return Slider;

})(SpriteGroup);

SliderKnob = (function(_super) {
  __extends(SliderKnob, _super);

  function SliderKnob(parent) {
    var image;

    this.parent = parent;
    image = Resources.get("sliderKnob");
    SliderKnob.__super__.constructor.call(this, image.width, image.height);
    this.image = image;
    LayerUtil.setOrder(this, LayerOrder.dialogUI);
  }

  return SliderKnob;

})(Sprite);
