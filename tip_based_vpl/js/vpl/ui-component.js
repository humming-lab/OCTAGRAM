// Generated by CoffeeScript 1.6.2
var Frame, HelpPanel, Page, Pager, PagerArrow, RingMenu, SelectorTip, SideSelectorArrow, SideTipSelector, UICloseButton, UIConfigWindow, UIOkButton, UIPanel, UIPanelContent, UISpriteComponent, UITextComponent, UITip, UITipConfigurator, UITipDirectionSelector, UITipSelector,
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

UISpriteComponent = (function(_super) {
  __extends(UISpriteComponent, _super);

  function UISpriteComponent(image) {
    if (image != null) {
      UISpriteComponent.__super__.constructor.call(this, image.width, image.height);
    }
    this.image = image;
    this.children = [];
    this.hidden = true;
    this.opacity = 0;
    this.fadeTime = 300;
    this.tl.setTimeBased();
  }

  UISpriteComponent.prototype.show = function() {
    var child, _i, _len, _ref, _results;

    if (this.hidden) {
      Game.instance.currentScene.addChild(this);
      this.hidden = false;
      this.tl.fadeIn(this.fadeTime);
      _ref = this.children;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        child = _ref[_i];
        _results.push(child.show());
      }
      return _results;
    }
  };

  UISpriteComponent.prototype.hide = function() {
    var child, _i, _len, _ref, _results;

    if (!this.hidden) {
      this.hidden = true;
      this.tl.fadeOut(this.fadeTime).then(function() {
        return Game.instance.currentScene.removeChild(this);
      });
      _ref = this.children;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        child = _ref[_i];
        _results.push(child.hide());
      }
      return _results;
    }
  };

  UISpriteComponent.prototype.addChild = function(child) {
    child.tl.setTimeBased();
    return this.children.push(child);
  };

  UISpriteComponent.prototype.removeChild = function(child) {
    var idx;

    idx = this.children.indexOf(child);
    if (idx !== -1) {
      return this.children.splice(idx, 1);
    }
  };

  return UISpriteComponent;

})(Sprite);

UITextComponent = (function(_super) {
  __extends(UITextComponent, _super);

  function UITextComponent(parent, text) {
    this.parent = parent;
    UITextComponent.__super__.constructor.call(this, text);
    this.hidden = true;
    this.opacity = 0;
    this.fadeTime = 300;
    this.tl.setTimeBased();
    this.children = [];
    this.font = "18px 'Meirio', 'ヒラギノ角ゴ Pro W3', sans-serif";
    this.color = "white";
    LayerUtil.setOrder(this, Environment.layer.dialogText);
  }

  UITextComponent.prototype.show = function() {
    var child, _i, _len, _ref, _results;

    if (this.hidden) {
      Game.instance.currentScene.addChild(this);
      this.hidden = false;
      this.tl.fadeIn(this.fadeTime);
      _ref = this.children;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        child = _ref[_i];
        _results.push(child.show());
      }
      return _results;
    }
  };

  UITextComponent.prototype.hide = function() {
    var child, _i, _len, _ref, _results;

    this.hidden = true;
    this.tl.fadeOut(this.fadeTime).then(function() {
      return Game.instance.currentScene.removeChild(this);
    });
    _ref = this.children;
    _results = [];
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      child = _ref[_i];
      _results.push(child.hide());
    }
    return _results;
  };

  return UITextComponent;

})(Label);

UIPanel = (function(_super) {
  __extends(UIPanel, _super);

  function UIPanel(content) {
    var image;

    this.content = content;
    image = Resources.get("panel");
    UIPanel.__super__.constructor.call(this, image);
    this.image = image;
    this.parent = null;
    this.label = new UITextComponent(this, "");
    this.closeButton = new UICloseButton(this);
    this.okButton = new UIOkButton(this);
    LayerUtil.setOrder(this, Environment.layer.dialog);
    this.okButton.moveTo(this.image.width / 2 - this.okButton.width / 2, this.image.height - this.okButton.height - 12);
    this.closeButton.moveTo(16, 12);
    this.label.moveTo(64, 14);
    this.addChild(this.content);
    this.addChild(this.closeButton);
    this.addChild(this.okButton);
    this.addChild(this.label);
  }

  UIPanel.prototype.setTitle = function(title) {
    return this.label.text = title;
  };

  UIPanel.prototype.setContent = function(content) {
    this.removeChild(this.content);
    this.content = content;
    return this.addChild(this.content);
  };

  UIPanel.prototype.show = function(parent) {
    this.parent = parent;
    GlobalUI.help.setText("");
    return UIPanel.__super__.show.call(this);
  };

  UIPanel.prototype.hide = function() {
    var msg;

    msg = CodeTip.selectedEffect.parent.description;
    GlobalUI.help.setText(msg);
    return UIPanel.__super__.hide.call(this);
  };

  return UIPanel;

})(UISpriteComponent);

UICloseButton = (function(_super) {
  __extends(UICloseButton, _super);

  function UICloseButton(parent) {
    var image;

    this.parent = parent;
    image = Resources.get("closeButton");
    UICloseButton.__super__.constructor.call(this, image);
    this.image = image;
    LayerUtil.setOrder(this, Environment.layer.dialogButton);
    this.addEventListener('touchstart', function() {
      return this.parent.hide();
    });
  }

  return UICloseButton;

})(UISpriteComponent);

UIOkButton = (function(_super) {
  __extends(UIOkButton, _super);

  function UIOkButton(parent) {
    var image;

    this.parent = parent;
    image = Resources.get("okButton");
    UIOkButton.__super__.constructor.call(this, image);
    this.image = image;
    LayerUtil.setOrder(this, Environment.layer.dialogButton);
  }

  return UIOkButton;

})(UISpriteComponent);

UITip = (function(_super) {
  __extends(UITip, _super);

  UITip.selectedEffect = null;

  UITip.selectedInstance = null;

  function UITip(parent, tip) {
    var _this = this;

    this.parent = parent;
    this.tip = tip;
    UITip.__super__.constructor.call(this, this.tip.image);
    this.description = this.tip.description;
    if (this.tip.icon != null) {
      this.icon = this.tip.icon.clone();
    }
    LayerUtil.setOrder(this, Environment.layer.dialogButton);
    if (this.icon != null) {
      LayerUtil.setOrder(this.icon, Environment.layer.dialogIcon);
    }
    this.addEventListener('touchstart', function() {
      if (!_this.hidden) {
        if (_this.isSelected()) {
          return _this.doubleClicked();
        } else {
          return _this.select();
        }
      }
    });
    if (UITip.selectedEffect == null) {
      UITip.selectedEffect = new SelectedEffect();
      LayerUtil.setOrder(UITip.selectedEffect, Environment.layer.dialogEffect);
    }
  }

  UITip.prototype.doubleClicked = function() {
    return this.parent.tipSelected(this.tip);
  };

  UITip.prototype.dragged = function() {};

  UITip.prototype.dragEnd = function() {};

  UITip.prototype.show = function() {
    UITip.__super__.show.call(this);
    if (this.icon != null) {
      this.icon.opacity = 0;
      this.icon.show(this);
      this.icon.tl.setTimeBased();
      return this.icon.tl.fadeIn(this.fadeTime);
    }
  };

  UITip.prototype.hide = function() {
    UITip.selectedEffect.hide();
    if (this.icon != null) {
      this.icon.hide();
    }
    return UITip.__super__.hide.call(this);
  };

  UITip.prototype.select = function() {
    GlobalUI.help.setText(this.tip.description);
    UITip.selectedEffect.show(this);
    return UITip.selectedInstance = this;
  };

  UITip.prototype.isSelected = function() {
    return UITip.selectedInstance === this;
  };

  return UITip;

})(UISpriteComponent);

UITipSelector = (function(_super) {
  __extends(UITipSelector, _super);

  function UITipSelector(parent) {
    this.parent = parent;
    UITipSelector.__super__.constructor.call(this, Resources.get("dummy"));
  }

  UITipSelector.prototype.addTip = function(tip) {
    var uiTip;

    uiTip = new UITip(this, tip);
    uiTip.moveTo(this.x + this.children.length * tip.width, this.y);
    return this.addChild(uiTip);
  };

  UITipSelector.prototype.tipSelected = function(tip) {
    var evt, idx, target;

    target = this.parent.parent;
    idx = target.getIndex();
    evt = document.createEvent('UIEvent', false);
    evt.initUIEvent('insertNewTip', true, true);
    evt.tip = tip;
    evt.x = idx.x;
    evt.y = idx.y;
    document.dispatchEvent(evt);
    return this.parent.hide();
  };

  return UITipSelector;

})(UISpriteComponent);

SelectorTip = (function(_super) {
  __extends(SelectorTip, _super);

  SelectorTip.selectedEffect = null;

  function SelectorTip(tip) {
    this.tip = tip;
    SelectorTip.__super__.constructor.call(this, this.tip.code);
    this.icon = this.tip.icon;
    this.description = this.tip.description;
    if (SelectorTip.selectedEffect == null) {
      SelectorTip.selectedEffect = new SelectedEffect();
    }
    LayerUtil.setOrder(this, Environment.layer.frameUI);
    LayerUtil.setOrder(SelectorTip.selectedEffect, Environment.layer.frameUIEffect);
    if (this.icon != null) {
      LayerUtil.setOrder(this.icon, Environment.layer.frameUIIcon);
    }
  }

  SelectorTip.prototype.showSelectedEffect = function() {
    return SelectorTip.selectedEffect.show(this);
  };

  SelectorTip.prototype.hideSelectedEffect = function() {
    return SelectorTip.selectedEffect.hide();
  };

  SelectorTip.prototype.doubleClicked = function() {};

  SelectorTip.prototype.createGhost = function() {
    var tip;

    tip = SelectorTip.__super__.createGhost.call(this);
    LayerUtil.setOrder(tip, Environment.layer.frameUI);
    if (tip.icon != null) {
      LayerUtil.setOrder(tip.icon, Environment.layer.frameUIIcon);
    }
    return tip;
  };

  SelectorTip.prototype.clone = function() {
    return this.tip.clone();
  };

  return SelectorTip;

})(CodeTip);

SideSelectorArrow = (function(_super) {
  __extends(SideSelectorArrow, _super);

  function SideSelectorArrow(parent) {
    this.parent = parent;
    SideSelectorArrow.__super__.constructor.call(this, Resources.get("arrow"));
    LayerUtil.setOrder(this, Environment.layer.frameUIArrow);
  }

  return SideSelectorArrow;

})(UISpriteComponent);

SideTipSelector = (function(_super) {
  __extends(SideTipSelector, _super);

  function SideTipSelector(x, y, parent) {
    var dummy,
      _this = this;

    this.parent = parent;
    SideTipSelector.__super__.constructor.call(this, Resources.get("sidebar"));
    this.moveTo(x, y);
    this.padding = 56;
    LayerUtil.setOrder(this, Environment.layer.frameUI);
    this.topArrow = new SideSelectorArrow();
    this.bottomArrow = new SideSelectorArrow();
    this.topArrow.rotate(-90);
    this.bottomArrow.rotate(90);
    this.topArrow.moveTo(this.x + this.width / 2 - this.topArrow.width / 2, this.y);
    this.bottomArrow.moveTo(this.x + this.width / 2 - this.bottomArrow.width / 2, this.y + this.height - this.bottomArrow.height);
    this.addChild(this.topArrow);
    this.addChild(this.bottomArrow);
    this.topArrow.addEventListener('touchstart', function() {
      return _this.scrollUp();
    });
    this.bottomArrow.addEventListener('touchstart', function() {
      return _this.scrollDown();
    });
    dummy = Resources.get("emptyTip");
    this.capacity = 8;
    this.scrollPosition = 0;
  }

  SideTipSelector.prototype.addTip = function(tip) {
    var uiTip;

    uiTip = new SelectorTip(tip);
    uiTip.moveTo(this.x + this.padding, this.y + this.padding + this.getTipNum() * tip.height);
    this.hideOuter(uiTip);
    return this.addChild(uiTip);
  };

  SideTipSelector.prototype.isOut = function(tip) {
    return tip.y < (this.topArrow.y + this.topArrow.height / 2) || tip.y > (this.bottomArrow.y - this.bottomArrow.height / 2);
  };

  SideTipSelector.prototype.hideOuter = function(tip) {
    var opacity;

    opacity = this.isOut(tip) ? 0 : 1;
    tip.opacity = opacity;
    if (tip.icon != null) {
      return tip.icon.opacity = opacity;
    }
  };

  SideTipSelector.prototype.getTipNum = function() {
    return this.children.length - 2;
  };

  SideTipSelector.prototype.isUpScrollable = function() {
    var rest;

    rest = this.getTipNum() - this.scrollPosition;
    return rest > (this.capacity + 1);
  };

  SideTipSelector.prototype.isDownScrollable = function() {
    return this.scrollPosition > 0;
  };

  SideTipSelector.prototype.scrollUp = function() {
    var child, _i, _len, _ref, _results;

    if (this.isUpScrollable()) {
      this.scrollPosition += 1;
      _ref = this.children;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        child = _ref[_i];
        if (child instanceof SelectorTip) {
          child.unselect();
          child.moveBy(0, -child.height);
          _results.push(this.hideOuter(child));
        } else {
          _results.push(void 0);
        }
      }
      return _results;
    }
  };

  SideTipSelector.prototype.scrollDown = function() {
    var child, _i, _len, _ref, _results;

    if (this.isDownScrollable()) {
      this.scrollPosition -= 1;
      _ref = this.children;
      _results = [];
      for (_i = 0, _len = _ref.length; _i < _len; _i++) {
        child = _ref[_i];
        if (child instanceof SelectorTip) {
          child.unselect();
          child.moveBy(0, child.height);
          _results.push(this.hideOuter(child));
        } else {
          _results.push(void 0);
        }
      }
      return _results;
    }
  };

  return SideTipSelector;

})(UISpriteComponent);

UITipConfigurator = (function(_super) {
  __extends(UITipConfigurator, _super);

  function UITipConfigurator(parent) {
    this.parent = parent;
    UITipConfigurator.__super__.constructor.call(this, Resources.get("dummy"));
  }

  return UITipConfigurator;

})(UISpriteComponent);

UITipDirectionSelector = (function(_super) {
  __extends(UITipDirectionSelector, _super);

  function UITipDirectionSelector(parent, center) {
    var bottom, left, leftBottom, leftTop, right, rightBottom, rightTop, top;

    this.parent = parent;
    this.center = center;
    UITipDirectionSelector.__super__.constructor.call(this, Resources.get("dummy"));
    left = new UITip(TipFactory.createEmptyTip());
    right = new UITip(TipFactory.createEmptyTip());
    top = new UITip(TipFactory.createEmptyTip());
    bottom = new UITip(TipFactory.createEmptyTip());
    leftTop = new UITip(TipFactory.createEmptyTip());
    leftBottom = new UITip(TipFactory.createEmptyTip());
    rightTop = new UITip(TipFactory.createEmptyTip());
    rightBottom = new UITip(TipFactory.createEmptyTip());
    this.center = new UITip(TipFactory.createStopTip());
  }

  return UITipDirectionSelector;

})(UITipSelector);

Pager = (function(_super) {
  __extends(Pager, _super);

  function Pager(topPage) {
    this.topPage = topPage;
    Pager.__super__.constructor.call(this, this.topPage.content);
    this.parent = null;
    this.next = new PagerArrow(this, this.topPage.next, true);
    this.prev = new PagerArrow(this, this.topPage.prev, false);
    this.next.moveTo(this.x + this.image.width - this.next.width, this.y + this.image.height / 2 - this.next.image.height / 2);
    this.prev.moveTo(this.x, this.y + this.image.height / 2 - this.prev.image.height / 2);
    this.next.addEventListener('touchstart', function() {
      return this.parent.toNextPage();
    });
    this.prev.addEventListener('touchstart', function() {
      return this.parent.toPrevPage();
    });
    this.addChild(this.next);
    this.addChild(this.prev);
  }

  Pager.prototype.changePage = function(newPage) {
    if (newPage.content != null) {
      this.setContent(newPage.content);
      this.setTitle(newPage.title);
      this.setNextPage(newPage.next);
      this.setPrevPage(newPage.prev);
      this.next.update();
      return this.prev.update();
    }
  };

  Pager.prototype.show = function(parent) {
    Pager.__super__.show.call(this);
    this.changePage(this.topPage);
    return this.parent = parent;
  };

  Pager.prototype.setNextPage = function(page) {
    return this.next.content = page;
  };

  Pager.prototype.setPrevPage = function(page) {
    return this.prev.content = page;
  };

  Pager.prototype.toNextPage = function() {
    this.content.hide();
    this.changePage(this.next.content);
    return this.content.show();
  };

  Pager.prototype.toPrevPage = function() {
    this.content.hide();
    this.changePage(this.prev.content);
    return this.content.show();
  };

  return Pager;

})(UIPanel);

Page = (function() {
  function Page(content, title) {
    this.content = content;
    this.title = title;
    this.nextPage = null;
    this.prevPage = null;
  }

  return Page;

})();

PagerArrow = (function(_super) {
  __extends(PagerArrow, _super);

  function PagerArrow(parent, content, isRightArrow) {
    this.parent = parent;
    this.content = content;
    PagerArrow.__super__.constructor.call(this, Resources.get("arrow"));
    if (!isRightArrow) {
      this.scaleX = -1;
    }
    LayerUtil.setOrder(this, Environment.layer.dialogButton);
  }

  PagerArrow.prototype.show = function() {
    if (this.content != null) {
      return PagerArrow.__super__.show.call(this);
    }
  };

  PagerArrow.prototype.update = function() {
    if ((this.content != null) && this.hidden) {
      this.show();
    }
    if ((this.content == null) && !this.hidden) {
      return this.hide();
    }
  };

  return PagerArrow;

})(UISpriteComponent);

UIPanelContent = (function(_super) {
  __extends(UIPanelContent, _super);

  function UIPanelContent(parent) {
    this.parent = parent;
    UIPanelContent.__super__.constructor.call(this, Resources.get("dummy"));
    this.addEventListener('enterframe', function() {
      return moveTo(this.parent.x, this.parent.y);
    });
  }

  return UIPanelContent;

})(UISpriteComponent);

UIConfigWindow = (function(_super) {
  __extends(UIConfigWindow, _super);

  function UIConfigWindow(parent) {
    this.parent = parent;
    UIConfigWindow.__super__.constructor.call(this, Resources.get("dummy"));
  }

  UIConfigWindow.prototype.show = function(target) {
    return UIConfigWindow.__super__.show.call(this);
  };

  return UIConfigWindow;

})(UISpriteComponent);

RingMenu = (function(_super) {
  __extends(RingMenu, _super);

  function RingMenu(parent) {
    this.parent = parent;
  }

  return RingMenu;

})(UISpriteComponent);

HelpPanel = (function(_super) {
  __extends(HelpPanel, _super);

  function HelpPanel(x, y, w, h, text) {
    this.text = text;
    HelpPanel.__super__.constructor.call(this, w, h);
    this.image = Resources.get("helpPanel");
    this.label = new Label(this.text);
    this.label._element = document.createElement("div");
    this.label.text = this.text;
    this.x = x;
    this.y = y;
    this.label.width = w;
    this.label.height = h;
    this.label.x = this.x + 16;
    this.label.y = this.y + 16;
    this.label.font = "18px 'Meirio', 'ヒラギノ角ゴ Pro W3', sans-serif";
    this.label.color = "white";
    LayerUtil.setOrder(this, Environment.layer.messageWindow);
    LayerUtil.setOrder(this.label, Environment.layer.messageText);
  }

  HelpPanel.prototype.mkMsgHtml = function(text) {
    return "<div class='msg'>" + text + "</div>";
  };

  HelpPanel.prototype.show = function() {
    Game.instance.currentScene.addChild(this);
    return Game.instance.currentScene.addChild(this.label);
  };

  HelpPanel.prototype.setText = function(text) {
    return this.label.text = this.mkMsgHtml(text);
  };

  HelpPanel.prototype.getText = function() {
    return this.label.text;
  };

  return HelpPanel;

})(Sprite);

Frame = (function() {
  function Frame(x, y) {
    var borderHeight, borderWidth, contentHeight, contentWidth, frameHeight, frameWidth;

    frameWidth = 640;
    frameHeight = 640;
    contentWidth = 480;
    contentHeight = 480;
    borderWidth = 16;
    borderHeight = 16;
    this.top = new Sprite(frameWidth, borderWidth);
    this.bottom = new Sprite(frameWidth, frameHeight - contentHeight - borderHeight);
    this.left = new Sprite(borderWidth, frameHeight);
    this.right = new Sprite(frameWidth - contentWidth - borderWidth, frameHeight);
    this.top.image = Resources.get("frameTop");
    this.bottom.image = Resources.get("frameBottom");
    this.left.image = Resources.get("frameLeft");
    this.right.image = Resources.get("frameRight");
    this.top.moveTo(x, y);
    this.bottom.moveTo(x, y + borderHeight + contentHeight);
    this.left.moveTo(x, y);
    this.right.moveTo(borderWidth + contentWidth, y);
    LayerUtil.setOrder(this.top, Environment.layer.frame);
    LayerUtil.setOrder(this.left, Environment.layer.frame);
    LayerUtil.setOrder(this.right, Environment.layer.frame);
    LayerUtil.setOrder(this.bottom, Environment.layer.frame);
  }

  Frame.prototype.show = function() {
    Game.instance.currentScene.addChild(this.top);
    Game.instance.currentScene.addChild(this.bottom);
    Game.instance.currentScene.addChild(this.left);
    return Game.instance.currentScene.addChild(this.right);
  };

  return Frame;

})();
