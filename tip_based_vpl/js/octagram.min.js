var LocalStorage,ServerStorage;LocalStorage=function(){function a(){}return a.prototype.save=function(a,b){return localStorage.setItem(a,JSON.stringify(b))},a.prototype.load=function(a){return JSON.parse(localStorage.getItem(a))},a}(),ServerStorage=function(){function a(){}return a.prototype.save=function(){},a.prototype.load=function(){},a}();var InstructionEvent,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};InstructionEvent=function(a){function b(a,c){this.params=c,b.__super__.constructor.call(this,a)}return __extends(b,a),b}(enchant.Event);var GroupedSprite,ImageSprite,SpriteGroup,_ref,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};SpriteGroup=function(a){function b(a){b.__super__.constructor.call(this),a&&(this.sprite=new Sprite(a.width,a.height),this.sprite.image=a)}return __extends(b,a),b.prototype.topGroup=function(){var a;for(a=this;a.parentNode&&!(a.parentNode instanceof Scene);)a=a.parentNode;return a},b.prototype.getAbsolutePosition=function(){var a,b;for(b={x:this.x,y:this.y},a=this.parentNode;null!=a&&!(a instanceof Scene);)b.x+=a.x,b.y+=a.y,a=a.parentNode;return b},b.prototype.setOpacity=function(a){var c,d,e,f,g;for(f=this.childNodes,g=[],d=0,e=f.length;e>d;d++)c=f[d],c instanceof Sprite?g.push(c.opacity=a):c instanceof b?g.push(c.setOpacity(a)):g.push(void 0);return g},b.prototype.setVisible=function(a){var c,d,e,f,g;for(f=this.childNodes,g=[],d=0,e=f.length;e>d;d++)c=f[d],c instanceof Sprite?g.push(c.visible=a):c instanceof b?g.push(c.setVisible(opacity)):g.push(void 0);return g},b.prototype.getWidth=function(){return this.sprite.width},b.prototype.getHeight=function(){return this.sprite.height},b}(Group),GroupedSprite=function(a){function b(){return _ref=b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.getAbsolutePosition=function(){var a,b;for(b={x:this.x,y:this.y},a=this.parentNode;null!=a&&!(a instanceof Scene);)b.x+=a.x,b.y+=a.y,a=a.parentNode;return b},b}(Sprite),ImageSprite=function(a){function b(a){b.__super__.constructor.call(this,a.width,a.height),this.image=a}return __extends(b,a),b}(Sprite);var ActionTip,BranchTip,EmptyTip,NopTip,Point,ReturnTip,SingleTransitionTip,StartTip,StopTip,ThinkTip,Tip,WallTip,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};Point=function(){function a(a,b){this.x=a,this.y=b}return a}(),Tip=function(){function a(){this.transitions={},this.index={x:0,y:0}}return a.prototype.addTransition=function(a,b){return this.transitions[a]=b},a.prototype.getTransition=function(a){return this.transitions[a]},a.prototype.clone=function(){return new a},a.prototype.copy=function(a){var b;a.index.x=this.index.x,a.index.y=this.index.y;for(b in this.transitions)a.transitions[b]=this.transitions[b];return a},a.prototype.execute=function(){return null},a.prototype.mkDescription=function(){return TipUtil.tipToMessage(this)},a.prototype.serialize=function(){return{name:this.constructor.name,index:this.index,transitions:this.transitions}},a.prototype.deserialize=function(a){return this.transitions=a.transitions,this.index=a.index},a}(),EmptyTip=function(a){function b(){b.__super__.constructor.call(this)}return __extends(b,a),b.prototype.clone=function(){return new b},b}(Tip),StopTip=function(a){function b(){b.__super__.constructor.call(this)}return __extends(b,a),b.prototype.clone=function(){return new b},b}(Tip),SingleTransitionTip=function(a){function b(a){b.__super__.constructor.call(this),this.setNext(a)}return __extends(b,a),b.prototype.setNext=function(a){return this.next=a,this.addTransition("next",this.next)},b.prototype.getNext=function(){return this.getTransition("next")},b.prototype.execute=function(){return this.getTransition("next")},b.prototype.clone=function(){return this.copy(new b(this.getNext()))},b}(Tip),ThinkTip=function(a){function b(a){b.__super__.constructor.call(this,a)}return __extends(b,a),b.prototype.clone=function(){return this.copy(new b(this.getNext()))},b}(SingleTransitionTip),NopTip=function(a){function b(a){b.__super__.constructor.call(this,a)}return __extends(b,a),b.prototype.clone=function(){return this.copy(new b(this.getNext()))},b}(ThinkTip),StartTip=function(a){function b(a){b.__super__.constructor.call(this,a)}return __extends(b,a),b.prototype.clone=function(){return this.copy(new b(this.getNext()))},b}(SingleTransitionTip),ReturnTip=function(a){function b(a){b.__super__.constructor.call(this,a)}return __extends(b,a),b.prototype.clone=function(){return this.copy(new b(this.getNext()))},b}(SingleTransitionTip),WallTip=function(a){function b(a){b.__super__.constructor.call(this,a)}return __extends(b,a),b.prototype.clone=function(){return this.copy(new b(this.getNext()))},b}(SingleTransitionTip),BranchTip=function(a){function b(a,c){b.__super__.constructor.call(this),this.addTransition("conseq",a),this.addTransition("alter",c)}return __extends(b,a),b.prototype.condition=function(){return!0},b.prototype.execute=function(){return b.__super__.execute.apply(this,arguments),this.condition()?this.getTransition("conseq"):this.getTransition("alter")},b.prototype.setConseq=function(a){return this.addTransition("conseq",a)},b.prototype.setAlter=function(a){return this.addTransition("alter",a)},b.prototype.getConseq=function(){return this.getTransition("conseq")},b.prototype.getAlter=function(){return this.getTransition("alter")},b.prototype.clone=function(){return this.copy(new b(this.getConseq(),this.getAlter()))},b}(Tip),ActionTip=function(a){function b(a){b.__super__.constructor.call(this,a)}return __extends(b,a),b.prototype.action=function(){},b.prototype.execute=function(){return this.action(),this.getTransition("next")},b.prototype.clone=function(){var a;return a=this.copy(new b(this.getNext()))},b}(SingleTransitionTip);var ActionInstruction,BranchInstruction,CustomInstructionActionTip,CustomInstructionBranchTip,Instruction,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},__slice=[].slice;Instruction=function(a){function b(){b.__super__.constructor.call(this),this.isAsynchronous=!1,this.parameters=[]}return __extends(b,a),b.prototype.onComplete=function(a){return null==a&&(a=null),this.dispatchEvent(new InstructionEvent("completeExecution",{tip:this,result:a}))},b.prototype.action=function(){},b.prototype.execute=function(){return this.action()},b.prototype.setAsynchronous=function(a){return null==a&&(a=!0),this.isAsynchronous=a},b.prototype.addParameter=function(a){var b=this;return a.onParameterComplete=function(){return b.onParameterComplete(a)},a.onValueChanged=function(){return b.onParameterChanged(a)},a.mkLabel=function(){return b.mkLabel(a)},this.parameters.push(a)},b.prototype.mkDescription=function(){},b.prototype.mkLabel=function(a){return a},b.prototype.getIcon=function(){},b.prototype.setConstructorArgs=function(){var a;return a=1<=arguments.length?__slice.call(arguments,0):[],this.constructorArgs=a},b.prototype.onParameterChanged=function(){},b.prototype.onParameterComplete=function(){},b.prototype.copy=function(a){var b,c,d,e;for(a.isAsynchronous=this.isAsynchronous,a.parameters=[],e=this.parameters,c=0,d=e.length;d>c;c++)b=e[c],a.addParameter(b.clone());return a},b.prototype.clone=function(){return this.copy(new b)},b.prototype.serialize=function(){var a;return{name:this.constructor.name,parameters:function(){var b,c,d,e;for(d=this.parameters,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.serialize());return e}.call(this)}},b.prototype.deserialize=function(a){var b,c,d,e,f,g;for(f=a.parameters,g=[],d=0,e=f.length;e>d;d++)b=f[d],g.push(function(){var a,d,e,f;for(e=this.parameters,f=[],a=0,d=e.length;d>a;a++)c=e[a],c.valueName===b.valueName&&f.push(c);return f}.call(this)[0].deserialize(b));return g},b}(EventTarget),ActionInstruction=function(a){function b(){b.__super__.constructor.call(this)}return __extends(b,a),b.prototype.clone=function(){return this.copy(new b)},b}(Instruction),BranchInstruction=function(a){function b(){b.__super__.constructor.call(this)}return __extends(b,a),b.prototype.action=function(){return!1},b.prototype.clone=function(){return this.copy(new b)},b}(Instruction),CustomInstructionActionTip=function(a){function b(a,c){this.instruction=a,b.__super__.constructor.call(this,c)}return __extends(b,a),b.prototype.action=function(){return this.instruction.execute()},b.prototype.isAsynchronous=function(){return this.instruction.isAsynchronous},b.prototype.mkDescription=function(){return this.instruction.mkDescription()},b.prototype.getIcon=function(){return this.instruction.getIcon()},b.prototype.clone=function(){return this.copy(new b(this.instruction.clone(),this.getNext()))},b.prototype.serialize=function(){var a;return a=b.__super__.serialize.apply(this,arguments),a.instruction=this.instruction.serialize(),a},b.prototype.deserialize=function(a){return b.__super__.deserialize.call(this,a),this.instruction.deserialize(a.instruction)},b}(ActionTip),CustomInstructionBranchTip=function(a){function b(a,c,d){this.instruction=a,b.__super__.constructor.call(this,c,d)}return __extends(b,a),b.prototype.condition=function(){return this.instruction.execute()},b.prototype.mkDescription=function(){return this.instruction.mkDescription()},b.prototype.isAsynchronous=function(){return this.instruction.isAsynchronous},b.prototype.getIcon=function(){return this.instruction.getIcon()},b.prototype.clone=function(){return this.copy(new b(this.instruction.clone(),this.getConseq,this.getAlter()))},b.prototype.serialize=function(){var a;return a=b.__super__.serialize.apply(this,arguments),a.instruction=this.instruction.serialize(),a},b.prototype.deserialize=function(a){return b.__super__.deserialize.call(this,a),this.instruction.deserialize(a.instruction)},b}(BranchTip);var executeEnemyProgram,executePlayerProgram,getEnemyProgram,getPlayerProgram,loadEnemyProgram,loadPlayerProgram,saveEnemyProgram,savePlayerProgram,showEnemyProgram,showPlayerProgram,test;getPlayerProgram=function(){return Game.instance.octagrams.getInstance(Game.instance.currentScene.world.playerProgramId)},getEnemyProgram=function(){return Game.instance.octagrams.getInstance(Game.instance.currentScene.world.enemyProgramId)},executePlayerProgram=function(){return getPlayerProgram().execute()},executeEnemyProgram=function(){return getEnemyProgram().execute()},savePlayerProgram=function(){return getPlayerProgram().save("player")},saveEnemyProgram=function(){return getEnemyProgram().save("enemy")},loadPlayerProgram=function(){return getPlayerProgram().load("player")},loadEnemyProgram=function(){return getEnemyProgram().load("enemy")},showPlayerProgram=function(){return Game.instance.octagrams.show(Game.instance.currentScene.world.playerProgramId)},showEnemyProgram=function(){return Game.instance.octagrams.show(Game.instance.currentScene.world.enemyProgramId)},test=function(){var a,b;return b=Game.instance.currentScene.world.playerProgram,a=Game.instance.currentScene.world.enemyProgram,b.load("test"),a.load("test"),b.execute(),a.execute()};var EventUtil,TipUtil,uniqueID;TipUtil=function(){function a(){}return a.tipToImage=function(a){var b;return b=a instanceof EmptyTip?"emptyTip":a instanceof ReturnTip?"returnTip":a instanceof StartTip?"startTip":a instanceof StopTip?"stopTip":a instanceof ActionTip?"actionTip":a instanceof BranchTip?"branchTip":a instanceof ThinkTip?"thinkTip":a instanceof WallTip?"wallTip":void 0,Resources.get(b)},a.tipToIcon=function(a){return a instanceof NopTip?Resources.get("iconNop"):void 0},a.tipToMessage=function(a){return a instanceof EmptyTip?TextResource.msg.empty:a instanceof ReturnTip?TextResource.msg["return"]:a instanceof StartTip?TextResource.msg.start:a instanceof StopTip?TextResource.msg.stop:a instanceof ActionTip?TextResource.msg.action:a instanceof BranchTip?TextResource.msg.branch:a instanceof WallTip?TextResource.msg.wall:a instanceof NopTip?TextResource.msg.nop:void 0},a}(),EventUtil=function(){function a(){}return a.createEvent=function(a){var b;return b=document.createEvent("UIEvent",!1),b.initUIEvent(a,!0,!0),b},a}(),uniqueID=function(){var a,b,c;return b=Math.floor(1e3*Math.random()),a=new Date,c=a.getTime(),b+c.toString()};var Resources,TextResource;Resources=function(){function a(){}return a.base="./",a.resources={emptyTip:"empty_tip_48x48.png",returnTip:"return_tip_48x48.png",startTip:"start_tip_48x48.png",actionTip:"action_tip_48x48.png",stopTip:"stop_tip_48x48.png",branchTip:"branch_tip_48x48.png",thinkTip:"think_tip_48x48.png",wallTip:"wall_tip_48x48.png",selectedEffect:"select_effect_48x48.png",execEffect:"exec_effect_48x48.png",mapTip:"map_tip_58x58.png",mapBorder:"map_border_12x58.png",mapBorder2:"map_border_58x12.png",mapEdge:"map_edge_12x12.png",transition:"transition_24x24.png",alterTransition:"alter_transition_24x24.png",panel:"panel_640x496.png",miniPanel:"panel_548x320.png",frame:"frame_640x640.png",frameLeft:"frame_left.png",frameRight:"frame_right.png",frameTop:"frame_top.png",frameBottom:"frame_bottom.png",helpPanel:"help_panel_144x640.png",closeButton:"close_btn_32x32.png",arrow:"arrow_64x64.png",filter:"filter_960x960.png",okButton:"ok_button_154x56.png",testObject:"test_obj_48x48.png",iconUp:"icon_up_32x32.png",iconDown:"icon_down_32x32.png",iconRandom:"icon_random_32x32.png",iconNop:"icon_nop_32x32.png",sidebar:"sidebar_160x496.png",slider:"slider_256x32.png",sliderKnob:"slider_knob_16x16.png",dummy:"dummy_1x1.png"},a.load=function(b){var c,d,e,f;e=a.resources,f=[];for(c in e)d=e[c],f.push(b.preload(a.base+d));return f},a.get=function(b){return Game.instance.assets[a.base+a.resources[b]]},a}(),TextResource=function(){function a(){}return a.msg={empty:"チップがセットされていません。",stop:"プログラムを停止します。",branch:"条件に応じて進行方向を分岐します。","return":"プログラムの開始地点に戻ります。",wall:"プログラムの開始地点に戻ります。",start:"プログラムの開始地点です。",action:"アクションを実行します。",nop:"何も実行しないで次へ進みます。",title:{selector:"挿入するチップを選択して下さい。",configurator:"パラメータ編集"}},a}();var ExecutionEffect,SelectedEffect,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},__bind=function(a,b){return function(){return a.apply(b,arguments)}};SelectedEffect=function(a){function b(){b.__super__.constructor.call(this,Resources.get("selectedEffect")),this.visible=!1,this.touchEnabled=!1}return __extends(b,a),b.prototype.show=function(a){return this.visible=!0,a.addChild(this)},b.prototype.hide=function(){return this.visible=!1,this.parentNode.removeChild(this)},b}(ImageSprite),ExecutionEffect=function(a){function b(){this._hide=__bind(this._hide,this),b.__super__.constructor.call(this,Resources.get("execEffect")),this.visible=!1,this.busy=!1,this.tl.setTimeBased()}return __extends(b,a),b.fadeTime=400,b.prototype.show=function(a){return this.tl.clear(),this.opacity=1,this.busy||this.visible||a.addChild(this),this.visible=!0},b.prototype.hide=function(){return this.visible?(this.tl.clear(),this.busy=!0,this.tl.fadeOut(b.fadeTime).then(this._hide)):void 0},b.prototype._hide=function(){return this.busy=!1,this.visible=!1,this.parentNode.removeChild(this)},b}(ImageSprite);var AlterTransition,NormalTransition,TipTransition,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};TipTransition=function(a){function b(a,c,d){this.src=c,this.dst=d,b.__super__.constructor.call(this,a.width,a.height),this.image=a,this.link(this.src,this.dst)}return __extends(b,a),b.prototype.link=function(a,b){var c,d;return c=this.calcPosition(a,b),d=this.calcRotation(a,b),this.moveTo(c.x,c.y),this.rotate(d)},b.prototype.calcPosition=function(a,b){var c,d,e,f;return c=b.x-a.x,d=b.y-a.y,e=c/2+this.image.width/2,f=d/2+this.image.height/2,{x:e,y:f}},b.prototype.calcRotation=function(a,b){var c,d,e,f;return d=b.x-a.x,e=b.y-a.y,c=d/Math.sqrt(d*d+e*e),f=180*Math.acos(c)/Math.PI,0>e&&(f*=-1),f},b.prototype.rotateToDirection=function(a){return a>-22.5&&22.5>=a?Direction.right:a>22.5&&67.5>=a?Direction.rightDown:a>67.5&&112.5>=a?Direction.down:a>112.5&&157.5>=a?Direction.leftDown:a>-157.5&&-112.5>=a?Direction.leftUp:a>-112.5&&-67.5>=a?Direction.up:a>-67.5&&-22.5>=a?Direction.rightUp:a>157.5||-157.5>=a?Direction.left:void 0},b.prototype.ontouchmove=function(a){var b,c,d,e,f,g,h,i;return i=TipFactory.createEmptyTip(),f={x:this.src.x+i.getWidth()/2,y:this.src.y+i.getHeight()/2},h=this.calcRotation(f,a),b=this.rotateToDirection(h),g=this.src.getIndex(),d=g.x+b.x,e=g.y+b.y,c=Game.instance.vpl.currentVM.cpu.getTip(d,e),c!==this.dst?(this.dst=c,null!=this.src.setConseq?this instanceof AlterTransition?this.src.setAlter(d,e,c):this.src.setConseq(d,e,c):this.src.setNext(d,e,c)):void 0},b.prototype.hide=function(){return this.parentNode.removeChild(this)},b.prototype.show=function(a){return a.addChild(this)},b}(Sprite),NormalTransition=function(a){function b(a,c){b.__super__.constructor.call(this,Resources.get("transition"),a,c)}return __extends(b,a),b}(TipTransition),AlterTransition=function(a){function b(a,c){b.__super__.constructor.call(this,Resources.get("alterTransition"),a,c)}return __extends(b,a),b}(TipTransition);var BranchTransitionCodeTip,CodeTip,Direction,JumpTransitionCodeTip,SingleTransitionCodeTip,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};Direction=function(){function a(){}return a.left=new Point(-1,0),a.right=new Point(1,0),a.up=new Point(0,-1),a.down=new Point(0,1),a.leftUp=new Point(-1,-1),a.leftDown=new Point(-1,1),a.rightUp=new Point(1,-1),a.rightDown=new Point(1,1),a.toDirection=function(a,b){return new Point(a,b)},a}(),CodeTip=function(a){function b(a){this.code=a,this.ontouchend=__bind(this.ontouchend,this),this.ontouchmove=__bind(this.ontouchmove,this),this.ontouchstart=__bind(this.ontouchstart,this),this.select=__bind(this.select,this),b.__super__.constructor.call(this,TipUtil.tipToImage(this.code)),this.immutable=this.code instanceof WallTip||this.code instanceof StartTip,this.description=this.code.mkDescription(),this.isTransitionSelect=!1,this.icon=this.getIcon(),this.dragMode=!1,this.isFirstClick=!1,this.dragStartX=0,this.dragStartY=0,this.parameters=null!=this.code.instruction?this.code.instruction.parameters:void 0,this.addChild(this.sprite),null!=this.icon&&(this.addChild(this.icon),this.icon.fitPosition()),this.executionEffect=new ExecutionEffect(this),null==b.selectedEffect&&(b.selectedEffect=new SelectedEffect)}return __extends(b,a),b.selectedEffect=null,b.clonedTip=null,b.prototype.isInnerTip=function(a,b){var c,d,e,f,g,h;return c=this.getAbsolutePosition(),d=this.getWidth(),f=c.x,e=c.x+d,h=c.y,g=c.y+d,a>f&&e>a&&b>h&&g>b},b.prototype.select=function(){return this.topGroup().ui.help.setText(this.description),this.isFirstClick=!this.isSelected(),this.showSelectedEffect()},b.prototype.unselect=function(){return this.topGroup().help.setText(""),this.hideSelectedEffect()},b.prototype.execute=function(){return null!=this.code?this.code.execute():null},b.prototype.createGhost=function(){var a;return null!=b.clonedTip&&b.clonedTip.hide(),a=this.clone(),a.setOpacity(.5),a.moveTo(this.x,this.y),a.sprite.touchEnabled=!1,a},b.prototype.ontouchstart=function(a){return this.isTransitionSelect=!this.isInnerTip(a.x,a.y),this.isTransitionSelect?void 0:(this.dragMode&&null!=b.clonedTip&&b.clonedTip.hide(),this.dragMode=!1,this.select())},b.prototype.ontouchmove=function(a){return this.isTransitionSelect?void 0:(this.dragMode||this.immutable||(this.dragMode=!0,this.dragStart(a)),this.dragged(a))},b.prototype.ontouchend=function(a){return this.immutable||(this.dragMode||!this.isSelected()||this.isFirstClick?this.dragMode&&this.dragEnd(a):this.doubleClicked()),b.selectedInstance=this},b.prototype.dragStart=function(a){return b.clonedTip=this.createGhost(),b.clonedTip.show(this.parentNode),this.dragStartX=a.x,this.dragStartY=a.y},b.prototype.dragged=function(a){var c,d;return null!=b.clonedTip?(c=a.x-this.dragStartX,d=a.y-this.dragStartY,b.clonedTip.moveTo(this.x+c,this.y+d)):void 0},b.prototype.dragEnd=function(){var a;return this.dragMode=!1,null!=b.clonedTip?(a=b.clonedTip.getAbsolutePosition(),this.topGroup().cpu.insertTipOnNearestPosition(a.x,a.y,b.clonedTip),b.clonedTip.hide()):void 0},b.prototype.doubleClicked=function(){return this.showConfigWindow()},b.prototype.showConfigWindow=function(){var a;return a=new ParameterConfigPanel(this.topGroup()),a.show(this)},b.prototype.isSelected=function(){return b.selectedEffect.parentNode===this},b.prototype.showExecutionEffect=function(){return this.executionEffect.show(this)},b.prototype.hideExecutionEffect=function(){return this.executionEffect.hide()},b.prototype.showSelectedEffect=function(){return this.isSelected()?void 0:b.selectedEffect.show(this)},b.prototype.hideSelectedEffect=function(){return b.selectedEffect.hide()},b.prototype.isAsynchronous=function(){return null!=this.code.isAsynchronous&&this.code.isAsynchronous()},b.prototype.setIcon=function(a){return this.icon=a,this.icon.fitPosition()},b.prototype.getIcon=function(){var a;return this.icon=null!=this.code.getIcon?this.code.getIcon():(a=TipUtil.tipToIcon(this.code),null!=a?new Icon(a):null),this.icon},b.prototype.setDescription=function(a){return this.description=a,this.onDescriptionChanged()},b.prototype.onDescriptionChanged=function(){return this.isSelected()?this.topGroup().ui.help.setText(this.description):void 0},b.prototype.setIndex=function(a,b){return this.code.index={x:a,y:b}},b.prototype.getIndex=function(){return this.code.index},b.prototype.show=function(a){return null!=a?a.addChild(this):void 0},b.prototype.hide=function(){return null!=this.parentNode?this.parentNode.removeChild(this):void 0},b.prototype.clone=function(){return new b(this.code.clone())},b.prototype.copy=function(a){return a.description=this.description,null!=this.icon&&(a.icon=this.icon.clone()),a},b.prototype.serialize=function(){return{name:this.constructor.name,code:this.code.serialize()}},b.prototype.deserialize=function(a){return this.code.deserialize(a.code),this.setDescription(this.code.mkDescription())},b}(SpriteGroup),SingleTransitionCodeTip=function(a){function b(a){b.__super__.constructor.call(this,a),this.trans=null}return __extends(b,a),b.prototype.setNext=function(a,b,c){return null!=this.trans&&this.trans.hide(),this.trans=new NormalTransition(this,c),this.trans.show(this),this.code.setNext({x:a,y:b})},b.prototype.getNextDir=function(){var a;return a=this.code.getNext(),null==a?null:Direction.toDirection(a.x-this.code.index.x,a.y-this.code.index.y)},b.prototype.clone=function(){return this.copy(new b(this.code.clone()))},b}(CodeTip),BranchTransitionCodeTip=function(a){function b(a){b.__super__.constructor.call(this,a),this.conseqTrans=null,this.alterTrans=null}return __extends(b,a),b.prototype.setConseq=function(a,b,c){return null!=this.conseqTrans&&this.conseqTrans.hide(),this.conseqTrans=new NormalTransition(this,c),this.conseqTrans.show(this),this.code.setConseq({x:a,y:b})},b.prototype.setAlter=function(a,b,c){return null!=this.alterTrans&&this.alterTrans.hide(),this.alterTrans=new AlterTransition(this,c),this.alterTrans.show(this),this.code.setAlter({x:a,y:b})},b.prototype.getConseqDir=function(){var a;return a=this.code.getConseq(),null==a?null:Direction.toDirection(a.x-this.code.index.x,a.y-this.code.index.y)},b.prototype.getAlterDir=function(){var a;return a=this.code.getAlter(),null==a?null:Direction.toDirection(a.x-this.code.index.x,a.y-this.code.index.y)},b.prototype.clone=function(){return this.copy(new b(this.code.clone()))},b}(CodeTip),JumpTransitionCodeTip=function(a){function b(a){b.__super__.constructor.call(this,a)}return __extends(b,a),b.prototype.setNext=function(a,b){return this.code.setNext({x:a,y:b})},b.prototype.clone=function(){return this.copy(new b(this.code.clone()))},b}(CodeTip);var Icon,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};Icon=function(a){function b(a,c,d){var e,f;f=null!=c?c:a.width,e=null!=d?d:a.height,b.__super__.constructor.call(this,f,e),this.image=a,this.parent=null,this.hidden=!0,this.touchEnabled=!1}return __extends(b,a),b.prototype.fitPosition=function(){return null!=this.parentNode?this.moveTo(this.parentNode.getWidth()/2-this.width/2,this.parentNode.getWidth()/2-this.height/2):void 0},b.prototype.clone=function(){var a;return a=new b(this.image,this.width,this.height),a.frame=this.frame,a},b}(Sprite);var TipParameter;TipParameter=function(){function a(a,b,c,d,e,f){this.valueName=a,this.value=b,this.min=c,this.max=d,this.step=e,this.id=f,this.text=""}return a.prototype.setValue=function(a){return this.value=a,this.text=toString(),this.onValueChanged()},a.prototype.getValue=function(){return this.value},a.prototype.onValueChanged=function(){},a.prototype.onParameterComplete=function(){},a.prototype.mkLabel=function(){},a.prototype.clone=function(){return this.copy(new a(this.valueName,this.value,this.min,this.max,this.step))},a.prototype.copy=function(a){return a.valueName=this.valueName,a.value=this.value,a.min=this.min,a.max=this.max,a.step=this.step,a.id=this.id,a},a.prototype.toString=function(){return this.value.toString()},a.prototype.serialize=function(){return{valueName:this.valueName,value:this.value}},a.prototype.deserialize=function(a){return this.setValue(a.value)},a}();var TipFactory;TipFactory=function(){function a(){}return a.createReturnTip=function(a,b){var c;return c=new JumpTransitionCodeTip(new ReturnTip),c.setNext(a,b),c},a.createWallTip=function(a,b){var c;return c=new JumpTransitionCodeTip(new WallTip),c.setNext(a,b),c},a.createStartTip=function(){return new SingleTransitionCodeTip(new StartTip)},a.createStopTip=function(){return new CodeTip(new StopTip)},a.createEmptyTip=function(){return new CodeTip(new EmptyTip)},a.createActionTip=function(a){return new SingleTransitionCodeTip(a)},a.createBranchTip=function(a){return new BranchTransitionCodeTip(a)},a.createThinkTip=function(a){return new SingleTransitionCodeTip(a)},a.createNopTip=function(){return a.createThinkTip(new NopTip)},a.createInstructionTip=function(b){return b instanceof ActionInstruction?a.createActionTip(new CustomInstructionActionTip(b)):b instanceof BranchInstruction?a.createBranchTip(new CustomInstructionBranchTip(b)):console.log("error : invalid instruction type.")},a}();var RandomBranchInstruction,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};RandomBranchInstruction=function(a){function b(){var a;b.__super__.constructor.call(this),this.threthold=50,a=new TipParameter("確率",50,0,100,1),this.addParameter(a)}return __extends(b,a),b.prototype.action=function(){var a;return a=Math.random(),100*a<this.threthold},b.prototype.clone=function(){var a;return a=this.copy(new b),a.threthold=this.threthold,a},b.prototype.onParameterChanged=function(a){return this.threthold=a.value},b.prototype.getIcon=function(){return new Icon(Resources.get("iconRandom"))},b.prototype.mkDescription=function(){return this.threthold+"%の確率で青矢印に進みます。<br>"+(100-this.threthold)+"%の確率で赤矢印に進みます。"},b}(BranchInstruction);var StackAddInstruction,StackBnzInstruction,StackDivInstruction,StackDupInstruction,StackGrtInstruction,StackMachine,StackModInstruction,StackMulInstruction,StackNotInstruction,StackRotInstruction,StackSubInstruction,StackSwpInstruction,StackXorInstruction,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};StackMachine=function(){function a(){this.stack=[]}return a.prototype.pop=function(){return this.stack.pop()},a.prototype.push=function(a){return this.stack.push(a)},a.prototype.binaryOp=function(a){return this.stack.length>1?this.push(a(this.pop(),this.pop())):void 0},a.prototype.unaryOp=function(a){return this.stack.length>0?this.push(a(this.pop())):void 0},a.prototype.add=function(){return this.binaryOp(function(a,b){return b+a})},a.prototype.sub=function(){return this.binaryOp(function(a,b){return b-a})},a.prototype.mul=function(){return this.binaryOp(function(a,b){return b*a})},a.prototype.div=function(){return this.binaryOp(function(a,b){return b/a})},a.prototype.mod=function(){return this.binaryOp(function(a,b){return b%a})},a.prototype.xor=function(){return this.binaryOp(function(a,b){return b^a})},a.prototype.grt=function(){return this.binaryOp(function(a,b){return b>a?1:0})},a.prototype.swap=function(){var a,b;return this.stack.length>1?(a=this.pop(),b=this.pop(),this.push(b),this.push(a)):void 0},a.prototype.not=function(){return this.unaryOp(0===this.stack.pop()?1:0)},a.prototype.dup=function(){var a;return this.stack.length>0?(a=this.pop(),this.push(a),this.push(a)):void 0},a.prototype.rot=function(){var a,b,c;return this.stack.length>3?(a=this.pop(),b=this.pop(),c=this.pop(),this.push(b),this.push(c),this.push(a)):void 0},a.prototype.bnz=function(){return null!=this.stack?0!==this.pop():!1},a.prototype.input=function(){return this.push(window.prompt())},a.prototype.toString=function(){var a;for(a="";null!=this.stack;)a+=String.fromCharCode(this.pop());return a},a}(),StackAddInstruction=function(a){function b(a){this.stack=a,b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.action=function(){return this.stack.add()},b.prototype.clone=function(){return this.copy(new b(this.stack))},b.prototype.getIcon=function(){return new Icon(Resources.get("iconRandom"))},b.prototype.mkDescription=function(){return"スタック操作命令(上級者向け)<br>スタックからx, yをポップして, x+yの値をプッシュする。"},b}(ActionInstruction),StackSubInstruction=function(a){function b(a){this.stack=a,b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.action=function(){return this.stack.sub()},b.prototype.clone=function(){return this.copy(new b(this.stack))},b.prototype.getIcon=function(){return new Icon(Resources.get("iconRandom"))},b.prototype.mkDescription=function(){return"スタック操作命令(上級者向け)<br>スタックからx, yをポップして, x-yの値をプッシュする。"},b}(ActionInstruction),StackMulInstruction=function(a){function b(a){this.stack=a,b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.action=function(){return this.stack.mul()},b.prototype.clone=function(){return this.copy(new b(this.stack))},b.prototype.getIcon=function(){return new Icon(Resources.get("iconRandom"))},b.prototype.mkDescription=function(){return"スタック操作命令(上級者向け)<br>スタックからx, yをポップして, x+yの値をプッシュする。"},b}(ActionInstruction),StackDivInstruction=function(a){function b(a){this.stack=a,b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.action=function(){return this.stack.div()},b.prototype.clone=function(){return this.copy(new b(this.stack))},b.prototype.getIcon=function(){return new Icon(Resources.get("iconRandom"))},b.prototype.mkDescription=function(){return"スタック操作命令(上級者向け)<br>スタックからx, yをポップして, x/yの値をプッシュする。"},b}(ActionInstruction),StackModInstruction=function(a){function b(a){this.stack=a,b.__super__.constructor.apply(this,arguments)
}return __extends(b,a),b.prototype.action=function(){return this.stack.mod()},b.prototype.clone=function(){return this.copy(new b(this.stack))},b.prototype.getIcon=function(){return new Icon(Resources.get("iconRandom"))},b.prototype.mkDescription=function(){return"スタック操作命令(上級者向け)<br>スタックからx, yをポップして, xをyで割った時の余りをプッシュする。"},b}(ActionInstruction),StackXorInstruction=function(a){function b(a){this.stack=a,b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.action=function(){return this.stack.xor()},b.prototype.clone=function(){return this.copy(new b(this.stack))},b.prototype.getIcon=function(){return new Icon(Resources.get("iconRandom"))},b.prototype.mkDescription=function(){return"スタック操作命令(上級者向け)<br>スタックからx, yをポップして, xとyの排他的論理和の値をプッシュする。"},b}(ActionInstruction),StackGrtInstruction=function(a){function b(a){this.stack=a,b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.action=function(){return this.stack.grt()},b.prototype.clone=function(){return this.copy(new b(this.stack))},b.prototype.getIcon=function(){return new Icon(Resources.get("iconRandom"))},b.prototype.mkDescription=function(){return"スタック操作命令(上級者向け)<br>スタックからx, yをポップして, x>yならば1をプッシュする。<br>そうでなければ0をプッシュする。"},b}(ActionInstruction),StackSwpInstruction=function(a){function b(a){this.stack=a,b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.action=function(){return this.stack.swap()},b.prototype.clone=function(){return new b(this.stack)},b.prototype.getIcon=function(){return new Icon(Resources.get("iconRandom"))},b.prototype.mkDescription=function(){return"スタック操作命令(上級者向け)<br>スタックからx, yをポップして, y, xの順でプッシュする。"},b}(ActionInstruction),StackNotInstruction=function(a){function b(a){this.stack=a,b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.action=function(){return this.stack.not()},b.prototype.clone=function(){return this.copy(new b(this.stack))},b.prototype.getIcon=function(){return new Icon(Resources.get("iconRandom"))},b.prototype.mkDescription=function(){return"スタック操作命令(上級者向け)<br>スタックからxをポップして, xが0ならば1をプッシュする。<br>そうでなければ0をプッシュする。"},b}(ActionInstruction),StackDupInstruction=function(a){function b(a){this.stack=a,b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.action=function(){return this.stack.dup()},b.prototype.clone=function(){return this.copy(new b(this.stack))},b.prototype.getIcon=function(){return new Icon(Resources.get("iconRandom"))},b.prototype.mkDescription=function(){return"スタック操作命令(上級者向け)<br>スタックからxをポップして, xを2回プッシュする。"},b}(ActionInstruction),StackRotInstruction=function(a){function b(a){this.stack=a,b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.action=function(){return this.stack.rot()},b.prototype.clone=function(){return this.copy(new b(this.stack))},b.prototype.getIcon=function(){return new Icon(Resources.get("iconRandom"))},b.prototype.mkDescription=function(){return"スタック操作命令(上級者向け)<br>スタックからx, y, zをポップして, y, z, xの順でプッシュする。"},b}(ActionInstruction),StackBnzInstruction=function(a){function b(a){this.stack=a,b.__super__.constructor.apply(this,arguments)}return __extends(b,a),b.prototype.action=function(){return this.stack.bnz()},b.prototype.clone=function(){return this.copy(new b(this.stack))},b.prototype.getIcon=function(){return new Icon(Resources.get("iconRandom"))},b.prototype.mkDescription=function(){return"スタック操作命令(上級者向け)<br>スタックからxをポップして, xが1ならば青矢印に進む。<br>そうでなければ赤矢印に進む。"},b}(BranchInstruction);var Counter,CounterBranchInstruction,CounterDecrementInstruction,CounterIncrementInstruction,CounterPopInstruction,CounterPushInstruction,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};Counter=function(){function a(){this.value=0}return a.prototype.inc=function(a){return null==a&&(a=1),this.value+=a},a.prototype.dec=function(a){return null==a&&(a=-1),this.value-=a},a.prototype.clone=function(){var b;return b=new a,b.value=this.value,b},a}(),CounterIncrementInstruction=function(a){function b(a){var c,d;this.counters=a,b.__super__.constructor.call(this),this.id=0,this.step=1,c=new TipParameter("カウンターID",0,0,this.counters.length,1),d=new TipParameter("増加量",1,1,100,1),c.id="id",d.id="step",this.addParameter(c),this.addParameter(d)}return __extends(b,a),b.prototype.action=function(){return this.counters[this.id].inc(this.step)},b.prototype.onParameterChanged=function(a){return"id"===a.id?this.id=a.value:"step"===a.id?this.step=a.value:void 0},b.prototype.getIcon=function(){return new Icon(Resources.get("iconRandom"))},b.prototype.mkDescription=function(){return"カウンター"+this.id+"を"+this.step+"増加させます。"},b.prototype.clone=function(){return this.copy(new b(this.counters))},b}(ActionInstruction),CounterDecrementInstruction=function(a){function b(a){var c,d;this.counters=a,b.__super__.constructor.call(this),this.id=0,this.step=1,c=new TipParameter("カウンターID",0,0,this.counters.length,1),d=new TipParameter("減少量",1,1,100,1),c.id="id",d.id="step",this.addParameter(c),this.addParameter(d)}return __extends(b,a),b.prototype.action=function(){return this.counters[this.id].dec(this.step)},b.prototype.onParameterChanged=function(a){return"id"===a.id?this.id=a.value:"step"===a.id?this.step=a.value:void 0},b.prototype.getIcon=function(){return new Icon(Resources.get("iconRandom"))},b.prototype.mkDescription=function(){return"カウンター"+this.id+"を"+this.step+"減少させます。"},b.prototype.clone=function(){return this.copy(new b(this.counters))},b}(ActionInstruction),CounterBranchInstruction=function(a){function b(a){var c,d;this.counters=a,b.__super__.constructor.call(this),this.id=0,this.threthold=0,c=new TipParameter("カウンターID",0,0,this.counters.length,1),d=new TipParameter("閾値",0,-100,100,1),c.id="id",d.id="threthold",this.addParameter(c),this.addParameter(d)}return __extends(b,a),b.prototype.action=function(){return this.counters[this.id].value>=this.threthold},b.prototype.onParameterChanged=function(a){return"id"===a.id?this.id=a.value:"threthold"===a.id?this.threthold=a.value:void 0},b.prototype.getIcon=function(){return new Icon(Resources.get("iconRandom"))},b.prototype.mkDescription=function(){return"カウンター"+this.id+"が"+this.threthold+"以上ならば青矢印に進みます。<br>"+"カウンター"+this.id+"が"+this.threthold+"未満ならば赤矢印に進みます。"},b.prototype.clone=function(){return this.copy(new b(this.counters))},b}(BranchInstruction),CounterPushInstruction=function(a){function b(a,c){var d;this.counters=a,this.stack=c,b.__super__.constructor.call(this),this.id=0,d=new TipParameter("カウンターID",0,0,this.counters.length,1),this.addParameter(d)}return __extends(b,a),b.prototype.action=function(){return this.stack.push(this.counters[this.id])},b.prototype.onParameterChanged=function(a){return this.id=a.value},b.prototype.getIcon=function(){return new Icon(Resources.get("iconRandom"))},b.prototype.mkDescription=function(){return"カウンター"+this.id+"の値を"+"スタックにプッシュします。"},b.prototype.clone=function(){return this.copy(new b(this.counters))},b}(ActionInstruction),CounterPopInstruction=function(a){function b(a,c){var d;this.counters=a,this.stack=c,b.__super__.constructor.call(this),this.id=0,d=new TipParameter("カウンターID",0,0,this.counters.length,1),this.addParameter(d)}return __extends(b,a),b.prototype.action=function(){return this.counters[this.id]=this.stack.pop()},b.prototype.onParameterChanged=function(a){return this.id=a.value},b.prototype.getIcon=function(){return new Icon(Resources.get("iconRandom"))},b.prototype.mkDescription=function(){return"スタックからxをポップして, カウンター"+this.id+"に代入します。"},b.prototype.clone=function(){return this.copy(new CounterPushInstruction(this.counters))},b}(ActionInstruction);var Frame,HelpPanel,TextLabel,UICloseButton,UIOkButton,UIPanel,UIPanelBody,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};TextLabel=function(a){function b(a){b.__super__.constructor.call(this,a),this.font="18px 'Meirio', 'ヒラギノ角ゴ Pro W3', sans-serif",this.color="white"}return __extends(b,a),b}(Label),UIPanel=function(a){function b(a){b.__super__.constructor.call(this,Resources.get("panel")),this.body=new UIPanelBody(this,a),this.addChild(this.sprite),this.addChild(this.body),this.setContent(a)}return __extends(b,a),b.prototype.setTitle=function(a){return this.body.label.text=a},b.prototype.setContent=function(a){return this.body.setContent(a)},b.prototype.onClosed=function(){},b.prototype.show=function(){return Game.instance.currentScene.addChild(this)},b.prototype.hide=function(a){return this.onClosed(a),Game.instance.currentScene.removeChild(this)},b}(SpriteGroup),UIPanelBody=function(a){function b(a,c){this.parent=a,this.content=c,b.__super__.constructor.call(this,Resources.get("miniPanel")),this.label=new TextLabel(""),this.moveTo(Environment.EditorX+Environment.ScreenWidth/2-this.getWidth()/2,Environment.EditorY+Environment.EditorHeight/2-this.getHeight()/2),this.closeButton=new UICloseButton(this.parent),this.okButton=new UIOkButton(this.parent),this.closedWithOK=!1,this.okButton.moveTo(this.getWidth()/2-this.okButton.width/2,this.getHeight()-this.okButton.height-24),this.closeButton.moveTo(32,24),this.label.moveTo(80,28),this.content.moveTo(90,24),this.addChild(this.sprite),this.addChild(this.closeButton),this.addChild(this.okButton),this.addChild(this.label)}return __extends(b,a),b.prototype.setContent=function(a){return this.content&&this.removeChild(this.content),this.content=a,this.content.moveTo(32,64),this.addChild(a)},b}(SpriteGroup),UICloseButton=function(a){function b(a){var c=this;this.parent=a,b.__super__.constructor.call(this,Resources.get("closeButton")),this.addEventListener("touchstart",function(){return c.parent.hide(!1)})}return __extends(b,a),b}(ImageSprite),UIOkButton=function(a){function b(a){var c=this;this.parent=a,b.__super__.constructor.call(this,Resources.get("okButton")),this.addEventListener("touchstart",function(){return c.parent.hide(!0)})}return __extends(b,a),b}(ImageSprite),HelpPanel=function(a){function b(a,c,d,e,f){this.text=f,b.__super__.constructor.call(this,Resources.get("helpPanel")),this.label=new TextLabel(this.text),this.moveTo(a,c),this.label.width=d,this.label.height=e,this.label.x=16,this.label.y=16,this.addChild(this.sprite),this.addChild(this.label)}return __extends(b,a),b.prototype.setText=function(a){return this.label.text=a},b.prototype.getText=function(){return this.label.text},b}(SpriteGroup),Frame=function(a){function b(){b.__super__.constructor.call(this,Resources.get("frame")),this.touchEnabled=!1}return __extends(b,a),b}(ImageSprite);var TipBackground,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};TipBackground=function(a){function b(a,c,d,e){var f,g,h,i,j,k,l,m,n,o,p,q,r,s;for(b.__super__.constructor.call(this),g=Resources.get("mapBorder"),f=Resources.get("mapTip"),n=Resources.get("emptyTip"),l=(f.width-1-n.width)/2,m=2*l+n.width,o=f.width,h=f.height,a+=g.height,c+=g.height,i=p=-1,r=d+1;r>=-1?r>p:p>r;i=r>=-1?++p:--p)for(j=q=-1,s=e+1;s>=-1?s>q:q>s;j=s>=-1?++q:--q)k=new Sprite(o,h),k.image=f,k.moveTo(a+j*m,c+i*m),this.addChild(k)}return __extends(b,a),b}(Group);var Cpu,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};Cpu=function(a){function b(a,c,d,e,f,g){this.xnum=d,this.ynum=e,this.vm=g,b.__super__.constructor.call(this,Resources.get("dummy")),this.tipTable=[],this.sx=f,this.sy=-1,this.storage=new LocalStorage,this.createTips(a,c)}return __extends(b,a),b.prototype.putTip=function(a,b,c,d){var e,f;return e=a+c.x,f=b+c.y,this.replaceTip(d,a,b)?d.setNext(e,f,this.getTip(e,f)):void 0},b.prototype.putBranchTip=function(a,b,c,d,e){var f,g,h,i;return h=a+c.x,i=b+c.y,f=a+d.x,g=b+d.y,this.replaceTip(e,a,b)?(e.setConseq(h,i,this.getTip(h,i)),e.setAlter(f,g,this.getTip(f,g))):void 0},b.prototype.putSingleTip=function(a,b,c){return this.replaceTip(c,a,b)},b.prototype.replaceTip=function(a,b,c){var d,e;return this.getTip(b,c).immutable?!1:(d=this.getTip(b,c),e=d.isSelected(),d.hide(this),a.moveTo(d.x,d.y),a.setIndex(b,c),a.show(this),e&&a.select(),this.setTip(b,c,a),!0)},b.prototype.addTip=function(a,b,c,d){return this.replaceTip(d,a+c.x,b+c.y)},b.prototype.putStartTip=function(a,b){var c,d,e;return e=new SingleTransitionCodeTip(new StartTip),d=TipFactory.createReturnTip(this.sx,this.sy),c=Direction.down,this.putTip(a,b,c,e),this.replaceTip(d,this.sx+c.x,this.sy+c.y)},b.prototype.createTips=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n;for(i=Resources.get("emptyTip"),f=Resources.get("mapTip"),j=i.width,c=i.height,g=(f.width-1-i.width)/2,h=2*g+j,d=k=-1,m=this.ynum+1;m>=-1?m>k:k>m;d=m>=-1?++k:--k)for(this.tipTable[d]=[],e=l=-1,n=this.xnum+1;n>=-1?n>l:l>n;e=n>=-1?++l:--l)i=this.isWall(e,d)?TipFactory.createWallTip(this.sx,this.sy):TipFactory.createEmptyTip(),i.moveTo(a+g+e*h,b+g+d*h),i.setIndex(e,d),i.show(this),this.tipTable[d][e]=i;return this.putStartTip(this.sx,this.sy)},b.prototype.insertNewTip=function(a,b,c){var d,e,f,g;return g=c.clone(),g instanceof JumpTransitionCodeTip?this.putSingleTip(a,b,g):null!=g.setNext?(f=c.getNextDir(),f=null!=f?f:Direction.down,this.putTip(a,b,f,g)):null!=g.setConseq?(e=c.getConseqDir(),d=c.getAlterDir(),e=null!=e?e:Direction.down,d=null!=d?d:Direction.right,this.putBranchTip(a,b,e,d,g)):this.putSingleTip(a,b,g)},b.prototype.getNearestIndex=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o;for(h=4294967295,i=-1,j=-1,f=l=-1,n=this.ynum+1;n>=-1?n>l:l>n;f=n>=-1?++l:--l)for(g=m=-1,o=this.xnum+1;o>=-1?o>m:m>o;g=o>=-1?++m:--m)k=this.getTip(g,f),d=k.x-a,e=k.y-b,c=d*d+e*e,h>c&&(h=c,i=g,j=f);return{x:i,y:j}},b.prototype.insertTipOnNearestPosition=function(a,b,c){var d;return d=this.getNearestIndex(a,b),this.insertNewTip(d.x,d.y,c)},b.prototype.serialize=function(){var a,b,c,d,e,f,g;for(c=[],a=d=-1,f=this.ynum+1;f>=-1?f>d:d>f;a=f>=-1?++d:--d)for(b=e=-1,g=this.xnum+1;g>=-1?g>e:e>g;b=g>=-1?++e:--e)c.push({x:b,y:a,tip:this.getTip(b,a).serialize()});return c},b.prototype.deserialize=function(a){var b,c,d,e,f;for(f=[],d=0,e=a.length;e>d;d++)b=a[d],c="WallTip"===b.tip.code.name?TipFactory.createWallTip(this.sx,this.sy):"StartTip"===b.tip.code.name?TipFactory.createStartTip():"EmptyTip"===b.tip.code.name?TipFactory.createEmptyTip():null==b.tip.code.instruction?this.vm.tipSet.findByCode(b.tip.code.name).clone():this.vm.tipSet.findByInst(b.tip.code.instruction.name).clone(),c.deserialize(b.tip),f.push(this.insertNewTip(b.x,b.y,c));return f},b.prototype.save=function(a){return this.storage.save(a,this.serialize())},b.prototype.load=function(a){return this.deserialize(this.storage.load(a))},b.prototype.getTip=function(a,b){return this.tipTable[b][a]},b.prototype.setTip=function(a,b,c){return this.tipTable[b][a]=c},b.prototype.getStartTip=function(){return this.getTip(this.sx,this.sy)},b.prototype.getStartPosition=function(){return{x:this.sx,y:this.sy}},b.prototype.getYnum=function(){return this.ynum},b.prototype.getXnum=function(){return this.xnum},b.prototype.isOuter=function(a,b){return-1===b||-1===a||b===this.ynum||a===this.xnum},b.prototype.isStart=function(a,b){return a===this.sx&&b===this.sy},b.prototype.isWall=function(a,b){return this.isOuter(a,b)&&!this.isStart(a,b)},b.prototype.isEmpty=function(a,b){return this.getTip(a,b).code instanceof EmptyTip},b}(Group);var Executer,__bind=function(a,b){return function(){return a.apply(b,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};Executer=function(a){function b(a){this.cpu=a,this.execNext=__bind(this.execNext,this),this.next=null,this.current=null,this.end=!1}return __extends(b,a),b.latency=30,b.prototype.getNext=function(){return null!=this.next?this.cpu.getTip(this.next.x,this.next.y):null},b.prototype._execute=function(a){return null!=this.current&&this.current.hideExecutionEffect(),this.current=a,this.current.showExecutionEffect(),this.current.isAsynchronous()&&(this.current.code.instruction.removeEventListener("completeExecution",this.execNext),this.current.code.instruction.addEventListener("completeExecution",this.execNext)),this.next=this.current.execute(),null==this.next&&(this.current.hideExecutionEffect(),this.current=null),a.isAsynchronous()?void 0:setTimeout(this.execNext,b.latency)},b.prototype.execute=function(){var a;return this.end=!1,a=this.cpu.getStartTip(),this._execute(a)},b.prototype.execNext=function(a){var b;if(this.end){if(this.current)return this.current.hideExecutionEffect()}else if(b=this.getNext(),null!=this.current&&this.current.isAsynchronous()&&a&&null!=a.params.result&&this.current instanceof BranchTransitionCodeTip&&(this.next=a.params.result?this.current.code.getConseq():this.current.code.getAlter(),b=this.getNext()),null!=b)return b===this.current&&(console.log("error : invalid execution timing."),this.next=this.current.code.getNext(),b=this.getNext()),this._execute(b)},b.prototype.stop=function(){return this.end=!0},b}(EventTarget);var ErrorChecker,ErrorData,__indexOf=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};ErrorChecker=function(){function a(){this.init()}return a.prototype.init=function(){return this.stack=[],this.visited=[],this.error=new ErrorData},a.prototype.detectError=function(a){var b;return b=a.getStartPosition(),this.init(),this._dfs(a,b),this.error},a.prototype._dfs=function(a,b){var c;return c=a.getTip(b.x,b.y),null!=c?__indexOf.call(this.stack,c)>=0?this._registerCycle(a,c):(this.stack.push(c),this.visited.push(c),c instanceof SingleTransitionCodeTip?this._dfs(a.getTip()):c instanceof BranchTransitionCodeTip&&(this._dfs(c.getConseq()),this._dfs(c.getAlter())),this.stack.pop()):void 0},a.prototype._registerCycle=function(a,b){var c,d;return d=this.stack.indexOf(b),c=this.stack.slice(d,this.stack.length-1),this.error.cycle.push(c)},a.prototype._registerUnreachable=function(){var a,b,c,d,e;for(e=[],b=c=0,d=cpu.getYnum();d>=0?d>c:c>d;b=d>=0?++c:--c)e.push(function(){var b,c,d;for(d=[],a=b=0,c=cpu.getXnum();c>=0?c>b:b>c;a=c>=0?++b:--b)d.push(console.log(""));return d}());return e},a}(),ErrorData=function(){function a(){this.cycle=[],this.unreachable=[]}return a}();var Slider,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};Slider=function(a){function b(a,c,d,e){var f,g;this.min=a,this.max=c,this.step=d,this.value=e,b.__super__.constructor.call(this,Resources.get("slider")),this.titleWidth=128,g=4,f=12,this.knob=new ImageSprite(Resources.get("sliderKnob")),this.knob.touchEnabled=!1,this.label=new TextLabel(""),this.title=new TextLabel(""),this.knob.moveTo(0,this.knob.width/2),this.title.moveTo(-this.titleWidth,g),this.label.moveTo(this.getWidth()+f,g),this.title.width=this.titleWidth,this.scroll(this.value),this.addChild(this.sprite),this.addChild(this.knob),this.addChild(this.label),this.addChild(this.title)}return __extends(b,a),b.prototype.ontouchstart=function(a){var b,c;return c=a.x-this.getAbsolutePosition().x,b=this.positionToValue(c),this.scroll(b)},b.prototype.ontouchmove=function(a){var b,c;return c=a.x-this.getAbsolutePosition().x,0>c&&(c=0),c>this.getWidth()&&(c=this.getWidth()),b=this.positionToValue(c),this.scroll(b)},b.prototype.onValueChanged=function(){return this.setText(this.value)},b.prototype.setTitle=function(a){return this.title.text=a},b.prototype.setValue=function(a){return this.value=a,this.onValueChanged()},b.prototype.setText=function(a){return this.label.text=a},b.prototype.scroll=function(a){var b;return this.value=this.adjustValue(a),b=this.valueToPosition(this.value),this.knob.moveTo(b-this.knob.width/2,this.knob.height/2),this.onValueChanged()},b.prototype.adjustValue=function(a){var b,c,d,e,f,g,h,i;for(e=this.min,d=4294967295,c=f=g=this.min,h=this.max,i=this.step;i>0?h>=f:f>=h;c=f+=i)b=Math.abs(a-c),d>b&&(d=b,e=c);return e},b.prototype.valueToPosition=function(a){var b,c,d;return b=this.max-this.min,c=a-this.min,d=this.getWidth()*(c/b)},b.prototype.positionToValue=function(a){var b;return b=a/this.getWidth(),this.min+b*(this.max-this.min)},b}(SpriteGroup);var SideTipSelector,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};SideTipSelector=function(a){function b(a,d){var e,f,g=this;b.__super__.constructor.call(this,160,500),this.moveTo(a,d),this.scrollPosition=0,e=new ImageSprite(Resources.get("sidebar")),this.addChild(e),f=Resources.get("emptyTip").height,this.topArrow=new ImageSprite(Resources.get("arrow")),this.topArrow.rotate(-90),this.topArrow.moveTo((this.width-this.topArrow.width)/2,0),this.topArrow.on(Event.TOUCH_START,function(){return g.scrollPosition<=0?void 0:(g.scrollPosition-=1,g.tipGroup.moveBy(0,f),g._updateVisibility())}),this.addChild(this.topArrow),this.bottomArrow=new ImageSprite(Resources.get("arrow")),this.bottomArrow.rotate(90),this.bottomArrow.moveTo((this.width-this.bottomArrow.width)/2,this.height-this.bottomArrow.height),this.bottomArrow.on(Event.TOUCH_START,function(){return g.scrollPosition>g._getTipCount()-c-1?void 0:(g.scrollPosition+=1,g.tipGroup.moveBy(0,-f),g._updateVisibility())}),this.addChild(this.bottomArrow),this.createTipGroup(),this.addChild(this.tipGroup)}var c;return __extends(b,a),c=8,b.prototype.createTipGroup=function(){return this.tipGroup=new EntityGroup(64,0),this.tipGroup.backgroundColor="#ff0000",this.tipGroup.moveTo(this.topArrow.x,this.topArrow.y+this.topArrow.height)},b.prototype.addTip=function(a){var b,d;return b=this._getTipCount(),d=a.clone(),b>=c&&d.setVisible(!1),d.moveTo(8,-6+b*a.getHeight()),this.tipGroup.addChild(d)},b.prototype._getTipCount=function(){return this.tipGroup.childNodes.length},b.prototype._updateVisibility=function(){var a,b=this;return a=function(a,c){return a>=0&&a<b._getTipCount()?b.tipGroup.childNodes[a].setVisible(c):void 0},a(this.scrollPosition-1,!1),a(this.scrollPosition+c,!1),a(this.scrollPosition,!0),a(this.scrollPosition+c-1,!0)},b.prototype.clearTip=function(){return this.removeChild(this.tipGroup),this.createTipGroup(),this.addChild(this.tipGroup),this.scrollPosition=0},b}(EntityGroup);var ParameterConfigPanel,ParameterSlider,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};ParameterSlider=function(a){function b(a){this.parameter=a,b.__super__.constructor.call(this,this.parameter.min,this.parameter.max,this.parameter.step,this.parameter.value)}return __extends(b,a),b.prototype.show=function(){return this.scroll(this.parameter.getValue()),b.__super__.show.call(this)},b.prototype.setText=function(){return b.__super__.setText.call(this,this.parameter.mkLabel())},b.prototype.onValueChanged=function(){return this.parameter.setValue(this.value),this.setText(this.parameter.mkLabel())},b}(Slider),ParameterConfigPanel=function(a){function b(a){this.target=a,b.__super__.constructor.call(this)}return __extends(b,a),b.prototype.addParameter=function(a){var b;return b=new ParameterSlider(a),b.moveTo(b.titleWidth,this.childNodes.length*b.getHeight()),b.setTitle(a.valueName),this.addChild(b)},b.prototype.show=function(a){var b,c,d,e,f,g;if(null!=a.parameters&&a.parameters.length>0){for(b={},g=a.parameters,c=e=0,f=g.length;f>e;c=++e)d=g[c],b[c]=d.getValue(),null==d._onValueChanged&&(d._onValueChanged=d.onValueChanged,d.onValueChanged=function(){return this._onValueChanged(),a.setDescription(a.code.mkDescription())}),this.addParameter(d);return this.target.ui.configPanel.setContent(this),this.target.ui.configPanel.show(a),this.target.ui.configPanel.onClosed=function(e){var f,g,h,i;if(e)return a.icon=a.getIcon(),a.setDescription(a.code.mkDescription());for(h=a.parameters,i=[],c=f=0,g=h.length;g>f;c=++f)d=h[c],d.setValue(b[c]),i.push(d.onParameterComplete());return i}}},b}(SpriteGroup);var Environment,Octagram,OctagramSet,TipBasedVPL,TipSet,__hasProp={}.hasOwnProperty,__extends=function(a,b){function c(){this.constructor=a}for(var d in b)__hasProp.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};Environment=function(){function a(){}return a.ScreenWidth=640,a.ScreenHeight=640,a.EditorWidth=480,a.EditorHeight=480,a.EditorX=16,a.EditorY=16,a.startX=4,a.startY=-1,a}(),TipSet=function(){function a(){this.tips=[]}return a.prototype.clear=function(){return this.tips=[]},a.prototype.addTip=function(a){return this.tips.push(a)},a.prototype.addInstruction=function(a){var b;return b=TipFactory.createInstructionTip(a),this.addTip(b)},a.prototype.findByInst=function(a){var b;return function(){var c,d,e,f;for(e=this.tips,f=[],c=0,d=e.length;d>c;c++)b=e[c],null!=b.code.instruction&&b.code.instruction.constructor.name===a&&f.push(b);return f}.call(this)[0]},a.prototype.findByCode=function(a){var b;return function(){var c,d,e,f;for(e=this.tips,f=[],c=0,d=e.length;d>c;c++)b=e[c],b.code.constructor.name===a&&f.push(b);return f}.call(this)[0]},a}(),OctagramSet=function(){function a(a,b,c,d){this.x=a,this.y=b,this.xnum=c,this.ynum=d,this.octagrams={},this.currentInstance=null}return a.prototype.createInstance=function(){var a;return a=new Octagram(this.x,this.y,this.xnum,this.ynum),this.octagrams[a.id]=a,a},a.prototype.removeInstance=function(){},a.prototype.getInstance=function(a){return this.octagrams[a]},a.prototype.show=function(a){return this.currentInstance&&this.currentInstance.hide(),this.currentInstance=this.octagrams[a],this.currentInstance.show()},a}(),Octagram=function(a){function b(a,c,d,e){var f,g;b.__super__.constructor.call(this),this.id=uniqueID(),this.tipSet=new TipSet,this.userInstructions=[],this.cpu=new Cpu(a+12,c+12,d,e,Environment.startX,this),this.executer=new Executer(this.cpu),f=new TipBackground(a,c,d,e),this.ui={},this.ui.frame=new Frame(0,0),this.ui.help=new HelpPanel(0,Environment.EditorHeight+c,Environment.ScreenWidth,Environment.ScreenWidth-Environment.EditorWidth-a,""),g=new ParameterConfigPanel(Environment.EditorWidth+a/2,0),this.ui.side=new SideTipSelector(Environment.EditorWidth+a/2,0),this.ui.configPanel=new UIPanel(g),this.ui.configPanel.setTitle(TextResource.msg.title.configurator),g.parent=this.ui.configPanel,this.addChild(f),this.addChild(this.cpu),this.addChild(this.ui.frame),this.addChild(this.ui.side),this.addChild(this.ui.help),this.addPresetInstructions()}return __extends(b,a),b.prototype.addInstruction=function(a){return this.tipSet.addInstruction(a),this.userInstructions.push(a)},b.prototype.addUserInstructions=function(){var a,b,c,d,e;for(d=this.userInstructions,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(this.tipSet.addInstruction(a));return e},b.prototype.addPresetInstructions=function(){var a,b,c,d,e,f,g,h;for(f=new StackMachine,a=[],b=h=0;100>h;b=++h)a[b]=new Counter;return e=TipFactory.createReturnTip(Environment.startX,Environment.startY),g=TipFactory.createStopTip(),d=TipFactory.createNopTip(),c=new RandomBranchInstruction,this.tipSet.addInstruction(c,Resources.get("iconRandom")),this.tipSet.addTip(e),this.tipSet.addTip(g),this.tipSet.addTip(d,Resources.get("iconNop")),this.tipSet.addInstruction(new CounterIncrementInstruction(a),Resources.get("iconRandom")),this.tipSet.addInstruction(new CounterDecrementInstruction(a),Resources.get("iconRandom")),this.tipSet.addInstruction(new CounterBranchInstruction(a),Resources.get("iconRandom")),this.tipSet.addInstruction(new CounterPushInstruction(a,f),Resources.get("iconRandom")),this.tipSet.addInstruction(new CounterPopInstruction(a,f),Resources.get("iconRandom")),this.tipSet.addInstruction(new StackAddInstruction(f),Resources.get("iconRandom")),this.tipSet.addInstruction(new StackSubInstruction(f),Resources.get("iconRandom")),this.tipSet.addInstruction(new StackMulInstruction(f),Resources.get("iconRandom")),this.tipSet.addInstruction(new StackDivInstruction(f),Resources.get("iconRandom")),this.tipSet.addInstruction(new StackModInstruction(f),Resources.get("iconRandom")),this.tipSet.addInstruction(new StackXorInstruction(f),Resources.get("iconRandom")),this.tipSet.addInstruction(new StackGrtInstruction(f),Resources.get("iconRandom")),this.tipSet.addInstruction(new StackSwpInstruction(f),Resources.get("iconRandom")),this.tipSet.addInstruction(new StackNotInstruction(f),Resources.get("iconRandom")),this.tipSet.addInstruction(new StackDupInstruction(f),Resources.get("iconRandom")),this.tipSet.addInstruction(new StackRotInstruction(f),Resources.get("iconRandom")),this.tipSet.addInstruction(new StackBnzInstruction(f),Resources.get("iconRandom"))},b.prototype.clearInstructions=function(){return this.tipSet.clear()},b.prototype.load=function(a){return this.cpu.load(a)},b.prototype.save=function(a){return this.cpu.save(a)},b.prototype.execute=function(){return this.executer.execute()},b.prototype.stop=function(){return this.executer.stop()},b.prototype.setTipToBar=function(){var a,b,c,d,e;for(this.clearInstructions(),this.ui.side.clearTip(),this.addUserInstructions(),this.addPresetInstructions(),d=this.tipSet.tips,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(this.ui.side.addTip(a));return e},b.prototype.show=function(){return this.setTipToBar(),Game.instance.currentScene.addChild(this)},b.prototype.hide=function(){return Game.instance.currentScene.removeChild(this)},b}(Group),TipBasedVPL=function(a){function b(a,c,d){b.__super__.constructor.call(this,a,c),this.fps=24,this.octagrams=new OctagramSet(16,16,8,8),Resources.base=d,Resources.load(this)}return __extends(b,a),b.prototype.onload=function(){var a,b,c,d;return a=16,c=16,b=8,d=8,Game.instance.vpl={},Game.instance.vpl.currentVM=new Octagram(a,c,b,d)},b}(Game);